<tal:block metal:use-macro="templates/page/macros/icing">
 <tal:block metal:fill-slot="menu_slot">
   <tr tal:condition="python:request.user.hasPermission ('View','address')">
    <td/>
    <td class="sidebar" nowrap>
     <span class="classblock">
      <a i18n:translate="" tal:attributes="href python:request.indexargs_url
         (classname, {':action' : 'export_csv_addresses'})">
       export addresses
      </a>
     </span>
    </td>
   </tr>
 </tal:block>

 <title metal:fill-slot="head_title">
  <span tal:replace="string:Abfrage ${Classname}" />
 </title>
 <span metal:fill-slot="body_title" tal:omit-tag="python:1"
       tal:content="string:Abfrage ${Classname}">
 </span>

 <tal:block metal:fill-slot="content">
  <tal:block tal:define=
   "batch request/batch
   ;pdict python: utils.properties_dict (db, context)
   ;tc    python:db._db.adr_type_cat.getnodeids ()
   ;filt  python:'typecat=%s' % ','.join (tc)
   ;props python:
     ( utils.ExtProperty (utils, pdict ['id'])
     , utils.ExtProperty (utils, pdict ['salutation'])
     , utils.ExtProperty (utils, pdict ['title'],    is_label = 0)
     , utils.ExtProperty (utils, pdict ['firstname'])
     , utils.ExtProperty (utils, pdict ['lastname'], is_label = 1)
     , utils.ExtProperty (utils, pdict ['country'])
     , utils.ExtProperty (utils, pdict ['postalcode'])
     , utils.ExtProperty (utils, pdict ['city'])
     , utils.ExtProperty (utils, pdict ['street'])
     , utils.ExtProperty (utils, pdict ['email'])
     , utils.ExtProperty (utils, pdict ['function'])
     , utils.ExtProperty (utils, pdict ['phone'])
     , utils.ExtProperty (utils, pdict ['fax'])
     , utils.ExtProperty (utils, pdict ['abos'])
     , utils.ExtProperty (utils, pdict ['payed_abos'])
     , utils.ExtProperty (utils, pdict ['adr_type'], filter=filt)
     , utils.ExtProperty (utils, pdict ['valid'], multiselect = 1)
     , utils.ExtProperty (utils, pdict ['invoices'], do_classhelp = False)
     )
   "
   tal:condition="context/is_view_ok">

   <tal:block metal:use-macro="templates/page/macros/search_display"></tal:block>

   <tal:block metal:use-macro="templates/page/macros/search_form">
    <tal:block metal:fill-slot="query_title">
     <tal:block tal:replace="python:'Abfrage ' + Classname">
     </tal:block>
    </tal:block>
   </tal:block>
  </tal:block>
 </tal:block>
</tal:block>
