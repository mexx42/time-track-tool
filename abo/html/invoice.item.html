<tal:block metal:use-macro="templates/page/macros/icing">

 <title metal:fill-slot="head_title">
  <span tal:condition="context/id"
        tal:replace="string:${Classname}: ${context/id} angelegt von
                     ${context/creator}">
  </span>
  <span tal:condition="not:context/id" tal:replace="string:Neue Rechnung"></span>
 </title>
 <span metal:fill-slot="body_title" tal:omit-tag="python:1"
       tal:content="Classname"></span>
 <tal:block metal:fill-slot="menu_slot">
   <tr tal:condition="python:request.user.hasPermission ('Edit','invoice')">
    <td/>
    <td class="sidebar" nowrap
     tal:condition="python:request.user.hasPermission ('Edit','invoice')">
     <span class="classblock">
      <a i18n:translate=""
         tal:attributes=
          "href python:'invoice%s?:action=mark_single_invoice_sent' %
           context.id">
       Generate single invoice
      </a>
     </span>
    </td>
   </tr>
 </tal:block>

 <tal:block metal:fill-slot="content">
  <tal:block metal:use-macro="templates/page/macros/formatted_class">
   <tal:block metal:fill-slot="formatted_class_content"
    tal:define="cond python:not context.abo.end">
    <tr>
     <th tal:content="structure python:utils.fieldname(classname, 'invoice_no')"></th>
     <td tal:content="structure context/invoice_no"></td>
     <th tal:content="structure python:utils.fieldname(classname, 'abo')"></th>
     <td tal:content="structure python: utils.ExtProperty
         (utils, context.abo.aboprice, item = context.abo).formatlink ()">
     </td>
    </tr>
    <tr tal:condition="context/id">
     <th tal:content="structure python:utils.fieldname(classname, 'subscriber')"></th>
     <td tal:content="structure python: ' '.join
      (( utils.ExtProperty
         ( utils
         , context.subscriber.firstname
         , item = context.subscriber
         ).formatlink ()
      ,  utils.ExtProperty
         ( utils
         , context.subscriber.lastname
         , item = context.subscriber
         ).formatlink ()
      ))">
     </td>
     <th tal:content="structure python:utils.fieldname(classname, 'payer')"></th>
     <td tal:content="structure python: ' '.join
      (( utils.ExtProperty
         ( utils
         , context.payer.firstname
         , item = context.payer
         ).formatlink ()
      ,  utils.ExtProperty
         ( utils
         , context.payer.lastname
         , item = context.payer
         ).formatlink ()
      ))">
     </td>
    </tr>
    <tr>
     <th tal:content="structure python:utils.fieldname(classname, 'period_start')"></th>
     <td tal:content="structure python:context.period_start.pretty('%Y-%m-%d')">
     </td>
     <th tal:content="structure python:utils.fieldname(classname, 'period_end')"></th>
     <td tal:content="structure python:context.period_end.pretty('%Y-%m-%d')">
     </td>
    </tr>
    <tr>
     <th tal:content="structure python:utils.fieldname(classname, 'amount')"></th>
     <td tal:content="structure python:utils.ExtProperty
         (utils, context.amount, item = context, editable = cond)
         .as_listentry ()">
     </td>
    </tr>
    <tr>
     <th tal:content="structure python:utils.fieldname(classname, 'payment')"></th>
     <td tal:content="structure python:utils.ExtProperty
         (utils, context.payment, item = context, editable = cond)
         .as_listentry ()">
     </td>
     <th tal:content="structure python:utils.fieldname(classname, 'currency')"></th>
     <td tal:content="structure python:utils.ExtProperty
         (utils, context.currency, item = context, editable = cond).menu ()">
     </td>
    </tr>
    <tr>
     <th tal:content="structure python:utils.fieldname(classname, 'balance_open')"></th>
     <td tal:content="structure python:utils.ExtProperty
         (utils, context.balance_open, item = context, editable = cond)
         .as_listentry ()">
     </td>
    </tr>
    <tr>
     <th tal:content="structure python:utils.fieldname(classname, 'receipt_no')"></th>
     <td tal:content="structure python:utils.ExtProperty
         (utils, context.receipt_no, item = context).as_listentry ()">
     </td>
     <th tal:content="structure python:utils.fieldname(classname, 'date_payed')"></th>
     <td tal:content="structure python:utils.ExtProperty
         (utils, context.date_payed, item = context, editable = cond)
         .as_listentry ()">
     </td>
    </tr>
    <tr>
     <th tal:content="structure python:utils.fieldname(classname, 'bookentry')"></th>
    <td tal:content="structure python:context.bookentry.pretty ('%Y-%m-%d')">
     </td>
    </tr>
    <tr>
     <th tal:content="structure python:utils.fieldname(classname, 'send_it')"></th>
     <td tal:content="structure python:utils.ExtProperty
         (utils, context.send_it, item = context, editable = cond)
         .as_listentry ()">
     </td>
     <th tal:content="structure python:utils.fieldname(classname, 'last_sent')"></th>
     <td tal:content="structure python:context.last_sent.pretty ('%Y-%m-%d')">
     </td>
    </tr>
    <tr>
     <th tal:content="structure python:utils.fieldname(classname, 'n_sent')"></th>
     <td tal:content="structure python:utils.ExtProperty
         (utils, context.n_sent, item = context, editable = cond)
         .as_listentry ()">
     </td>
     <th tal:content="structure python:utils.fieldname(classname, 'invoice_group')"></th>
     <td tal:content="structure python:utils.ExtProperty
         (utils, context.invoice_group, item = context, editable = False)
         .as_listentry ()">
     </td>
    </tr>
   </tal:block>
  </tal:block>
 </tal:block>

</tal:block>
