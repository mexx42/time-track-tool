<tal:block metal:use-macro="templates/page/macros/icing">

 <title metal:fill-slot="head_title">
  <span tal:condition="context/id"
        tal:replace="string:${Classname}: ${context/id} angelegt von
                     ${context/creator}">
  </span>
  <span tal:condition="not:context/id" tal:replace="string:Neues Abo"></span>
 </title>
 <span metal:fill-slot="body_title" tal:omit-tag="python:1"
       tal:content="Classname"></span>
 <tal:block metal:fill-slot="menu_slot">
   <tr tal:condition="python:request.user.hasPermission ('View','address')">
     <td class="sidebar" nowrap
      tal:condition="python:request.user.hasPermission ('View','tmplate')">
      <span class="classblock">
       <select name="tmplates"
        onChange="javascript:document.location=document.forms['menubar'].elements['tmplates'].options[document.forms['menubar'].elements['tmplates'].options.selectedIndex].value;">

        <option value="" i18n:translate="">
        -- tmplates --
        </option>
        <tal:block tal:repeat="o python:db.tmplate.filter (sort=('+','name'))">
         <option tal:content="o/name"
          tal:attributes="value
           python:'address%s?:action=personalized_template&tmplate=%s' %
            (context.id, o.id)"/>
        </tal:block>
       </select>
      </span>
     </td>
     <td class="sidebar" nowrap>
      <span class="classblock"
       tal:condition="python:request.user.hasPermission ('Edit','abo')">
       <a i18n:translate=""
          tal:attributes="href string:abo?:template=item&subscriber=${context/id}&payer=${context/id}">
        New Subscription for
        <tal:block i18n:name="lastname" tal:replace="context/lastname"/>
       </a>
      </span>
      <span class="classblock"
       tal:condition="python:request.user.hasPermission ('Edit','letter')">
       <a i18n:translate=""
          tal:attributes="href string:letter?:template=item&address=${context/id}">
        New Letter for
        <tal:block i18n:name="lastname" tal:replace="context/lastname"/>
       </a>
      </span>
     </td>
   </tr>
 </tal:block>

 <tal:block metal:fill-slot="content">
  <tal:block metal:use-macro="templates/page/macros/formatted_class">
   <tal:block metal:fill-slot="formatted_class_content">
    <tr>
     <th tal:content="structure python:utils.fieldname(classname, 'salutation')"></th>
     <td tal:content="structure context/salutation/field"></td>
    </tr>
    <tr>
     <th tal:content="structure python:utils.fieldname(classname, 'title')"></th>
     <td tal:content="structure context/title/field"></td>
     <th tal:content="structure python:utils.fieldname(classname, 'lettertitle')"></th>
     <td tal:content="structure context/lettertitle/field"></td>
    </tr>
    <tr>
     <th tal:content="structure python:utils.fieldname(classname, 'firstname')"></th>
     <td>
      <table border="0" cellspacing="0" cellpadding="0">
       <tr>
        <td tal:content="structure python:context.firstname.field (24)"></td>
        <td tal:content="structure python:context.initial.field (3)"></td>
       </tr>
      </table>
     </td>
     <th tal:content="structure python:utils.fieldname(classname, 'lastname')"
         class="required"></th>
     <td tal:content="structure context/lastname/field"></td>
    </tr>
    <tr>
     <th tal:content="structure python:utils.fieldname(classname, 'country')"
         class="required"></th>
     <td>
      <table border="0" cellspacing="0" cellpadding="0">
       <tr>
        <td tal:content="structure python:context.country.field (4)"></td>
        <td>&nbsp</td>
        <th tal:content="structure python:utils.fieldname(classname, 'postalcode')"
            class="required"></th>
        <td tal:content="structure python:context.postalcode.field (10)"></td>
       </tr>
      </table>
     </td>
     <th tal:content="structure python:utils.fieldname(classname, 'city')"
         class="required"></th>
     <td tal:content="structure context/city/field"></td>
    </tr>
    <tr>
     <th tal:content="structure python:utils.fieldname(classname, 'street')"
         class="required"></th>
     <td tal:content="structure context/street/field"></td>
     <th tal:content="structure python:utils.fieldname(classname, 'email')"></th>
     <td tal:content="structure context/email/field"></td>
    </tr>
    <tr>
     <th tal:content="structure python:utils.fieldname(classname, 'function')"></th>
     <td>
      <textarea tal:content="context/function/plain"
                name="function"
                wrap="hard"
                rows="3"
                cols="30">
      </textarea>
     </td>
     <th tal:content="structure python:utils.fieldname(classname, 'phone')"></th>
     <td>
      <textarea tal:content="context/phone/plain"
                name="phone"
                wrap="hard"
                rows="3"
                cols="30">
      </textarea>
     </td>
    </tr>
    <tr>
     <th tal:content="structure python:utils.fieldname(classname, 'adr_type')"></th>
     <td tal:define="tc python:','.join (db._db.adr_type_cat.getnodeids ())">
      <span tal:content="structure context/adr_type/field"/>
      <span tal:replace="structure python:db.adr_type.classhelp
           ( properties='code,description'
           , property='adr_type'
           , filter='typecat=%s' % tc
           , pagesize=500
           , sort='code'
           )"/>
     </td>
     <th tal:content="structure python:utils.fieldname(classname, 'fax')"></th>
     <td tal:content="structure context/fax/field"></td>
    </tr>
    <tr>
     <th></th><td></td>
     <th tal:content="structure python:utils.fieldname(classname, 'valid')"></th>
     <td tal:content="structure context/valid/menu"></td>
    </tr>
    <tr tal:condition="context/id">
     <th tal:content="structure python:utils.fieldname(classname, 'abos')"></th>
     <td align="top">
      <table border="0" cellspacing="0" cellpadding="0">
       <tr tal:repeat="abo context/abos">
        <td>
         <a tal:attributes="href string:abo${abo/id}
                           ;class python:utils.linkclass (abo)
                           "
            tal:content="abo/aboprice">
         </a>
        </td>
       </tr>
      </table>
     </td>
     <th tal:content="structure python:utils.fieldname(classname, 'payed_abos')"></th>
     <td align="top">
      <table border="0" cellspacing="0" cellpadding="0">
       <tr tal:repeat="abo context/payed_abos">
        <td>
         <a tal:attributes="href  string:abo${abo/id}
                           ;class python:utils.linkclass (abo)
                           "
            tal:content="abo/aboprice">
         </a>
        </td>
       </tr>
      </table>
     </td>
    </tr>
   </tal:block>
  </tal:block>
 </tal:block>

</tal:block>
