<tal:block metal:define-macro="icing">
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
                               "http://www.w3.org/TR/html4/strict.dtd">
<html tal:define="
   uname         python:str(request.user.username)
 ; classname     context/_classname|db/user/_classname
 ; klass         python:db [classname] or default
 ; is_user       python:uname!='anonymous'
 ; lbl           klass/_klass/labelprop
 ; labelprop     python:(lbl,'lastname')[lbl == 'title' and hasattr (context, 'lastname')]
">
 <head>
  <title metal:define-slot="head_title">Welcome @ TTTech</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8;">
  <link rel="stylesheet" type="text/css" href="@@file/style.css">
  <script tal:replace="structure request/base_javascript"></script>
 </head>
 <body class="body">
  <table class="body" tal:condition="not:is_user" align="center" valign="middle">
   <tr>
<!-- login -->
    <td>
<form method="POST" name="login_form" tal:attributes="action request/base">
     <table class="form">
      <tr>
       <td colspan="2" align="center">Welcome to <br>Roundup Issue Tracking system @ TTTech<br>
                                      <font size="-2">Note: You definitely need <b>Cookies</b> and <b>JavaScript</b> enabled.</font></td>
      </tr>
      <tr>
       <th>Login:</th>
       <td><input size="10" name="__login_name"></td>
      </tr>
      <tr>
       <th>Password:</th>
       <td><input size="10" type="password" name="__login_password"></td>
      </tr>
      <tr>
       <td colspan="2" align="center">
        <input type="submit" name="@action" value="Login">
<!-- XXX: needs some cleanup in this logic and also in the referring template
        <a href="user?@template=forgotten">Forgot your password?</a>
-->
       </td>
      </tr>
     </table>
     <script language="javascript">
     <!--
       document.login_form.__login_name.focus ();
       document.login_form.__login_name.select ();
     -->
     </script>
</form>
    </td>
   </tr>
  </table>

<!-- menubar -->
<form name="menubar">
  <table bgcolor="#eeeeee" tal:condition="is_user">
   <tr>
<!-- home -->
<!--
    <td class="sidebar">
     <span class="classblock">
      <a tal:attributes="href config/TRACKER_WEB">Home</a>
     </span>
    </td>
-->

<!-- create new -->
    <td class="sidebar" nowrap>
     <span class="classblock">
      <select name="create_new"
              onChange="javascript:document.location=document.forms['menubar'].elements['create_new'].options[document.forms['menubar'].elements['create_new'].options.selectedIndex].value + '?@template=item'; ">
       <option>-- Create New --</option>
       <option value="action_item">Action Item</option>
       <option tal:condition="python:request.user.hasPermission('Edit', 'meeting')"
               value="meeting">Meeting</option>
       <option tal:condition="python:request.user.hasPermission('Edit', 'release')"
               value="release">Release</option>
       <option tal:condition="python:request.user.hasPermission('Edit', 'feature')"
               value="feature">Feature</option>
       <option tal:condition="python:request.user.hasPermission('Edit', 'defect')"
               value="defect">Defect</option>
       <option tal:condition="python:request.user.hasPermission('Edit', 'user')"
               value="user">User</option>
      </select>
<!--
     <input type="button" value="Go" href="#" onClick="javascript:document.location=document.forms['menubar'].elements['create_new'].options[document.forms['menubar'].elements['create_new'].options.selectedIndex].value + '?@template=item'; ">
-->
     </span>
    </td>

<!-- queries
%3Aaction=search&%3Astartwith=0&%3Apagesize=20&%3Asort=id&%3Asortdir=on&%3Agroup=&%3Acolumns=id&%3Acolumns=title&%3Acolumns=responsible&responsible=5&status=&meeting=&nosy=&id=&title=&deadline=&%3Asearch_text=&%40queryname=mexx+items
-->
    <td class="sidebar" nowrap>
     <span class="classblock"
           tal:define="default_query string:@action=search&:startwith=0&:pagesize=20&:sort=id&:sortdir=on&:group=&:columns=id&:columns=title&:columns=responsible&responsible=&id=&title=&:search_text=&@queryname=">
      <select name="query"
              onChange="javascript:document.location=document.forms['menubar'].elements['query'].options[document.forms['menubar'].elements['query'].options.selectedIndex].value; ">
       <option>-- View / Query --</option>
       <option value="query?@template=edit">Manage Queries</option>
       <tal:block tal:define="name string:Action Items;
                              klass string:action_item">
        <tal:block metal:use-macro="templates/page/macros/query_list"/>
       </tal:block>
       <tal:block tal:define="name string:Meetings;
                              klass string:meeting">
        <tal:block metal:use-macro="templates/page/macros/query_list"/>
       </tal:block>
       <tal:block tal:define="name string:Releases;
                              klass string:release">
        <tal:block metal:use-macro="templates/page/macros/query_list"/>
       </tal:block>
       <tal:block tal:define="name string:Features;
                              klass string:feature">
        <tal:block metal:use-macro="templates/page/macros/query_list"/>
       </tal:block>
       <tal:block tal:define="name string:Tasks;
                              klass string:task">
        <tal:block metal:use-macro="templates/page/macros/query_list"/>
       </tal:block>
       <tal:block tal:define="name string:Defects;
                              klass string:defect">
        <tal:block metal:use-macro="templates/page/macros/query_list"/>
       </tal:block>
      </select>
<!--
      <input type="button" value="Go" href="#" onClick="javascript:document.location=document.forms['menubar'].elements['selected_query'].options[document.forms['menubar'].elements['selected_query'].options.selectedIndex].value; ">
-->
     </span>
    </td>

<!-- template specific menues -->
<!--
    <tal:block metal:define-slot="menubar"></tal:block>
-->

<!-- user list -->
    <td class="sidebar">
     <span class="classblock">
      <a tal:condition="python:request.user.hasPermission('View', 'user')
                            or request.user.hasPermission('Edit', 'user')"
         href="user" >User&nbsp;List</a>
     </span>
    </td>

<!-- username -> link to own profile -->
    <td class="sidebar">
     <span class="classblock">
      <a tal:attributes="href string:user${request/user/id}"
         tal:content="string:${request/user/username}"></a>
     </span>
    </td>

<!-- logout -->
    <td class="sidebar">
     <span class="classblock">
      <a href="?@action=logout">Logout</a>
     </span>
    </td>
   </tr>
  </table>
</form>

<!-- body_title -->
  <tal:block tal:condition="is_user">
   <h3><span metal:define-slot="body_title"></span></h3>
  </tal:block>

<!-- errors --->
  <p tal:condition = "options/error_message | nothing"
     class         = "error-message"
     tal:repeat    = "m options/error_message"
     tal:content   = "structure m">error</p>
  <p tal:condition = "options/ok_message | nothing"
     class         = "ok-message"
     tal:repeat    = "m options/ok_message"
     tal:content   = "structure m">error</p>

<!-- page content -->
  <tal:block tal:condition="is_user">
   <span class="content" metal:define-slot="content"></span>
  </tal:block>

<!-- debug output -->
 <pre tal:condition="request/form/debug | nothing" tal:content="request"></pre>
 </body>
</html>
</tal:block>

<!-- list of queries - needs 'klass' and 'name' and 'default_query' defined -->
<tal:block metal:define-macro="query_list">
       <option tal:attributes="value string:${klass}?${default_query}"
               tal:content="name"></option>
       <option tal:define="queries python:db.query.filter(filterspec={'private_for':None, 'klass':klass})"
               tal:repeat="q queries"
               tal:attributes="value string:${klass}?@template=index&@queryname=${q/name}&queryid=${q/id}&${q/url}"
               tal:content="structure string:&nbsp;&nbsp;${q/name}"
               >  Global Queries</option>
       <tal:block tal:condition="request/user/queries">
       <option tal:define="queries python:db.query.filter(filterspec={'private_for':request.user.id, 'klass':klass, 'id':[q.id for q in request.user.queries]})"
               tal:repeat="q queries"
               tal:attributes="value string:${klass}?@template=index&@queryname=${q/name}&queryid=${q/id}&${q/url}"
               tal:content="structure string:&nbsp;&nbsp;&nbsp;&nbsp;${q/name}"
               >    Private Queries</option>
       </tal:block>
</tal:block>


<!-- the following macro is used for all pages which display a TTT_Issue_Class item. -->

<td metal:define-macro="ttt_issue">
 <span tal:condition="python:not (context.is_view_ok() or context.is_edit_ok())">
 You are not allowed to view this page.
 </span>
<form method="POST"
      onSubmit="return submit_once()"
      name="itemSynopsis"
      enctype="multipart/form-data"
      tal:condition="context/is_view_ok"
      tal:attributes="action context/designator">

 <input type="hidden" name="@template" value="item">
 <input type="hidden" name="@required" value="title">

 <table class="form" border="0">
  <tr>
   <th class="required">Title</th>
   <td colspan="3"
       tal:content="structure python:context.title.field (size=60)"></td>
  </tr>

  <tr>
   <th>Responsible</th>
   <td colspan="3"
       tal:content="structure context/responsible/menu"></td>
  </tr>

  <tal:block metal:define-slot="ttt_issue_content"></tal:block>

  <tr>
   <th>Nosy List</th>
   <td colspan="3">
    <span tal:replace="structure context/nosy/field" />
    <span tal:condition="context/is_edit_ok"
          tal:replace="structure python:db.user.classhelp
                                            ( 'username,firstname,lastname'
                                            , property='nosy'
                                            , width='600')" /><br>
   </td>
  </tr>

  <tr tal:condition="context/is_edit_ok">
   <th>Message</th>
   <td colspan="3">
    <textarea tal:content="request/form/@note/value | default"
              name="@note"
              wrap="hard"
              rows="8"
              cols="80"></textarea>
   </td>
  </tr>

  <tr tal:condition="context/is_edit_ok">
   <th></th>
   <td colspan="3">
    <tal:block tal:replace="structure context/submit"/>
    <input tal:condition="context/id"
           type="button" value="Show History"
           tal:attributes="onClick string:javascript:help_window('${context/designator}?@template=history','600','300')">
   </td>
  </tr>
 </table>
 <p tal:condition="context/id" tal:content="structure string:Created on
   <b>${context/creation}</b> by <b>${context/creator}</b>, last
   changed <b>${context/activity}</b> by <b>${context/actor}</b>."></p>

</form>

 <table class="form" tal:condition="not:context/id">
 <tr>
  <td>Note:&nbsp;</td>
  <th class="required">highlighted</th>
  <td>&nbsp;fields are required.</td>
 </tr>
 </table>

 <table class="messages" tal:condition="context/messages">
  <tr>
   <th colspan="3" class="header">Messages</th>
  </tr>
  <tal:block tal:repeat="msg context/messages/reverse">
  <tr>
   <th><a tal:attributes="href string:msg${msg/id}"
          tal:content="string:msg${msg/id}"></a></th>
   <th tal:content="string:Author: ${msg/author}">author</th>
   <th tal:content="string:Date: ${msg/date}">date</th>
<!--
   <th>
    <form style="padding:0" tal:condition="context/is_edit_ok"
          tal:attributes="action string:issue${context/id}">
     <input type="hidden" name="@remove@messages" tal:attributes="value msg/id">
     <input type="hidden" name="@action" value="edit">
     <input type="submit" value="remove">
    </form>
   </th>
-->
  </tr>
  <tr>
   <td colspan="3" class="content">
    <pre tal:content="structure msg/content/hyperlinked">content</pre>
   </td>
  </tr>
  </tal:block>
 </table>
</td>

<!-- the following lists a nice list of files plus file upload form -->
<tal:block metal:define-macro="ttt_issue_files">
 <!-- list of files -->
 <table class="files" tal:condition="context/files">
  <tr>
   <th>File name</th>
   <th>Uploaded</th>
   <th>Type</th>
  </tr>
  <tr tal:repeat="file context/files">
   <td>
    <a tal:attributes="href file/download_url"
       tal:content="file/name">dld link</a>
   </td>
   <td>
    <span tal:content="file/creator">creator's name</span>,
    <span tal:content="file/creation">creation date</span>
   </td>
   <td tal:content="file/type" />
  </tr>
 </table>
 <!-- add new file -->
 <input type="file" name="@file" size="40">
</tal:block>

<tal:block metal:define-macro="ttt_issue_pdf_files">
 <!-- list of files -->
 <table class="files" tal:condition="context/files">
  <tr>
   <th>File name</th>
   <th>Uploaded</th>
   <th>Type</th>
  </tr>
  <tr tal:repeat="file context/files">
   <td>
    <a tal:attributes="href file/download_url"
       tal:content="file/name">dld link</a>
   </td>
   <td>
    <span tal:content="file/creator">creator's name</span>,
    <span tal:content="file/creation">creation date</span>
   </td>
   <td tal:content="file/type" />
  </tr>
 </table>
 <!-- add new file -->
 <input type="file" name="pdf_file-1@content" size="40">
 <input type="hidden" name="@link@files" value="pdf_file-1">
</tal:block>


<!-- the following is used to have those nifty index/search form on one page -->
<!-- the caller needs to define a list of tuples for the properties: -->
<!--  props = (("<name to display>", "<designator>"), ...) -->

<tal:block metal:define-macro="ttt_search_nav">
<!-- previous / next links -->
   <tr tal:condition="request/form">
    <th tal:attributes="colspan python:len(request.columns)">
     <table width="100%">
      <tr class="navigation">
       <th class="left">
        <a tal:define="prev batch/previous"
           tal:condition="prev"
           tal:attributes="href python:str(request.indexargs_href(request.classname,
           {':startwith':prev.first, ':pagesize':prev.size}))">&lt;&lt;&nbsp;previous</a></th>
       <th tal:condition="batch/sequence_length"
           tal:content="structure python:'<nobr>showing %d - %d of %d in total</nobr>'
                               % ( batch.start
                                 , batch.start + batch.length - 1
                                 , batch.sequence_length
                                 )"
           >
       </th>
       <th tal:condition="not:batch/sequence_length"><nobr>Sorry, no results found</nobr></th>
       <th class="right">
        <a tal:define="next batch/next"
           tal:condition="next"
           tal:attributes="href python:str(request.indexargs_href(request.classname,
           {':startwith':next.first, ':pagesize':next.size}))">next&nbsp;&gt;&gt;</a></th>
      </tr>
     </table>
    </th>
   </tr>
</tal:block>

<!--
 the next two ttt_search_display and ttt_search_form needs the following variables set up
 as follows:
 props: ( (<attribute_name_to_display>, <attribute_name>, <class>, <display_attribute>, <opt>)
        , ...
        )
   where: <attribute_name_to_display> is the name which is displayed for the attribute <attribute_name>
          <attribute_name> is the name of the attribute we define something here
          <class> when the attribute is a link (or multilink), this specifies the target we link to
          <display_attribute> is the attribute of the target class which gets displayed
          <opt> optional attributes:
                'M' for multilinks - which get a href'd seperately
                'V' for values - get only displayed
                'D' for dates - may hava a date entry box in the search_form
                'L' for links - get linked
                'T' for `title` - gets linked to it's issues `item` page

   note: attributes 'id' and 'title' are treated specially
         - title gets linked to issues item page
         - id will only be printed

 multi: ( <attribute>
        , ...
        )
   where: <attribute> is the attribute which gets a select box in the search form, all other not
                      listed here get free form text entry fields
-->

<!-- display the search results -->
<tal:block metal:define-macro="ttt_search_results">
 <tal:block tal:condition="not:context/is_view_ok">
  You are not allowed to view this page.
 </tal:block>

 <tal:block tal:define="batch request/batch"
            tal:condition="context/is_view_ok">
  <table class="list" border=1>
   <tr>
<!-- list all properties we want to see -->
    <tal:block tal:repeat="prop props">
     <th tal:condition="python:request.show[prop[1]]"
         tal:content="python:prop[0]"></th>
    </tal:block>
   </tr>
   <tal:block metal:use-macro="templates/page/macros/ttt_search_nav"></tal:block>
   <!-- items found -->
   <tal:block tal:repeat="i batch">
    <tr tal:condition="python:request.group[1] and
                              batch.propchanged(request.group[1])">
     <th tal:attributes="colspan python:len(request.columns)"
         tal:content="python:i[request.group[1]]" class="group">
     </th>
    </tr>
    <tr tal:attributes="class python:['normal', 'alt'][repeat['i'].index%2]">
     <!-- all the properties: label property and id will be made a link -->
     <!-- filter out only the properties the user wants to see -->
     <tal:block tal:repeat="prop python:[p for p in props
                                         if p[1] in request.show.columns.keys ()]">
      <td tal:condition="python:prop[4] in ('V', 'D')"
          tal:content="python:i[prop[1]]"></td>
      <td tal:condition="python:prop[4] == 'T'">
       <a tal:attributes="href string:${i/designator}"
          tal:content="i/title"></a>
      </td>
      <td tal:condition="python:prop[4] == 'L' and i[prop[1]].isset()">
       <a tal:attributes="href python:prop[2]+i [prop[1]].id"
          tal:content="python:i[prop[1]]"></a>
      </td>
      <td tal:condition="python:prop[4] == 'L' and not i[prop[1]].isset()">&nbsp;</td>
      <td tal:condition="python:prop[4] == 'M' and i[prop[1]].isset()">
       <nobr tal:define="chain python:i [prop [1]];
                         c_len python:len (chain)"
             tal:repeat="item chain">
        <a tal:attributes="href  python:prop[2]+item.id"
           tal:content="python:item [prop[3]]"></a><tal:block
           tal:content="python:str(((((repeat['item'].index+1)%(c_len))!=0) and ',')or'')"></tal:block>
       </nobr>
      </td>
      <td tal:condition="python:prop[4] == 'M' and not i[prop[1]].isset()">&nbsp;</td>
     </tal:block>
    </tr>
   </tal:block> <!-- repeat i batch -->
  </table>
 </tal:block>
</tal:block>

<tal:block metal:define-macro="ttt_search_form">
<!-- query specification form -->
<form method="GET"
      name="query"
      tal:attributes="action request/classname">
<!-- no need for "structure python:request.indexargs_form(..." all other
     values are set via the search form below, only "startwidth" should be
     set magically ...
    <tal:block tal:replace="structure python:request.indexargs_form(sort=0, group=0, filter=1, filterspec=1, columns=0, pagesize=0, ignore={'filter':'status', 'filterspec':'status'})">
    </tal:block>
 -->
  <input type="hidden" name=":action" value="search">
  <input type="hidden" name=":startwith" tal:attributes="value request/startwith">
  <table border="0" bgcolor="#e0c0c0">
   <tr>
    <th bgcolor="#C08080">
     <tal:block metal:define-slot="query_title">Current Query Specification</tal:block>:
    </th>
   </tr>

   <tr>
    <td>
     View
     <input type="text" size="4" name=":pagesize"
            tal:attributes="value request/pagesize"> items per page,
      Sort by:<select name=":sort"
                      onChange="this.form.elements[':startwith'].value='0'">
         <option value="">- nothing -</option>
         <option tal:repeat="prop props"
                 tal:attributes="selected python:prop[1]==request.sort[1];
                                 value    python:prop[1]"
                 tal:content="python:prop[0]"
         ></option>
        </select>
        Descending:<input type="checkbox"
                          name=":sortdir"
                          onChange="this.form.elements[':startwith'].value='0'"
                          tal:attributes="checked python:request.sort[0] == '-'">
     - Group by:<select name=":group"
                        onChange="this.form.elements[':startwith'].value='0'">
         <option value="">- nothing -</option>
         <option tal:repeat="prop props"
                 tal:attributes="selected python:prop[1]==request.group[1];
                                 value    python:prop[1]"
                 tal:content="python:prop[0]"
         ></option>
        </select>
        Descending:<input type="checkbox"
                          name=":groupdir"
                          onChange="this.form.elements[':startwith'].value='0'"
                          tal:attributes="checked python:request.group[0] == '-'">
    </td>
   </tr>

   <tr>
    <td>
     <table border="0" bgcolor="#e0c0c0">
      <!-- fill in custom query data -->
      <!-- fill in multi selection boxes -->
      <tr>
       <th style="text-align:center;">View:</th>
   <tal:block tal:repeat="prop props">
       <th tal:condition="python:prop[1] in multi"
           tal:content="python:prop[0]+':'"></th>
   </tal:block>
      </tr>

      <tr>
       <!-- View -->
       <td style="text-align:center;">
        <select multiple name=":columns" size="7">
         <option tal:repeat="prop props"
                 tal:attributes="selected python:request.show[prop[1]];
                                 value    python:prop[1]"
                 tal:content="python:prop[0]"></option>
        </select>
       </td>
   <tal:block tal:repeat="prop props">
       <td style="text-align:center;"
           tal:condition="python:prop[1] in multi">
        <select multiple
                size="7"
                tal:attributes="name python:prop[1]"
                tal:define="form_vals python:request.filterspec.get(prop[1]) or []">
         <option value=""
                 tal:attributes="selected not:form_vals">don't care</option>
         <option tal:repeat="s python:db[prop[2]].list()"
                 tal:attributes="value    s/id;
                                 selected python:s.id in form_vals"
                 tal:content="python:s[prop[3]]"></option>
        </select>
       </td>
   </tal:block>
      </tr>
     </table>
    </td>
   </tr>

   <tr>
    <td>
     <table border="0" bgcolor="#e0c0c0">
      <!-- fill in text entry fields -->
   <tal:block tal:repeat="prop props">
      <tr tal:condition="python:prop[1] not in multi">
       <th style="text-align:right;"
           tal:content="python:prop[0]+':'"></th>
       <td tal:condition="python:prop[1] not in multi">
        <input type="text"
               size="40"
               tal:attributes="value python:request.form.getvalue(prop[1]) or nothing;
                               name  python:prop[1]">
        <span tal:condition="python:prop[4] in ('L', 'M')"
              tal:replace="structure python:db[prop[2]].classhelp
                                         ( properties='id,title,status,responsible'
                                         , property=prop[1]
                                         , form='query'
                                         )"/>
       </td>
      </tr>
   </tal:block>
      <tr>
       <th style="text-align:right;">Search full text:</th>
       <td><input type="text"
                  size="40"
                  name=":search_text"
                  onChange="this.form.elements[':startwith'].value='0'"
                  tal:attributes="value request/form/:search_text/value | nothing">
       (Searches also in messages)</td>
      </tr>
<!-- submit button -->
      <tr>
       <th></th>
       <td>
        <input type="submit"
               value="Update view & don't store this query">
       </td>
      </tr>
      <tr>
      <th style="text-align:right;">This query's name:</th>
       <td>
        <input type="text"
               name="_queryname"
               tal:attributes="value request/form/@queryname/value | default">
        <input type="hidden" name="@queryname">
        <span tal:condition="request/form/queryid/value | nothing">
         <a tal:attributes="href string:query${request/form/queryid/value};"
          >(edit this query)</a>
         <input type="hidden" name="queryid"
                tal:attributes="value request/form/queryid/value">
<!--
         <b>Private for me:</b>
         <select tal:condition="request/form/queryid/value | nothing"
                tal:attributes="name string:query${request/form/queryid/value}@private_for"
                tal:define="uid request/user/id;
                            qid request/form/queryid/value;
                            qry python:db.query.getItem (qid)">
         <option tal:attributes="selected python:qry.private_for == uid;
                                 value uid">yes</option>
         <option tal:attributes="selected python:qry.private_for == None"
                 value="-1">no</option>
         </select>
         <b>Delete this query</b>
         <input type="checkbox"
                tal:attributes="name string:${request/user/designator}@remove@queries;
                                value request/form/queryid/value;">
-->
        </span>
       </td>
      </tr>
<!-- submit button -->
      <tr>
       <th></th>
       <td>
        <input type="submit"
               value="Update view & store this query"
               onclick="document.forms ['query'].elements ['@queryname'].value =
                        document.forms ['query'].elements ['_queryname'].value;">
       </td>
      </tr>
     </table>
    </td>
   </tr>
  </table>
</form>
</tal:block>

<!-- begin not used stuff from above -->
<!-- END -->


<!--
The following macros are intended to be used in search pages.

The invoking context must define a "name" variable which names the
property being searched.

See issue.search.html in the classic template for examples.
-->
<td metal:define-macro="search_input">
  <input tal:attributes="value python:request.form.getvalue(name) or nothing;
                         name name">
</td>

<td metal:define-macro="search_popup">
  <!--
    context needs to specify the popup "columns" as a comma-separated
    string (eg. "id,title" or "id,name,description") as well as name
  -->
  <input tal:attributes="value python:request.form.getvalue(name) or nothing;
                         name name">
  <span tal:replace="structure python:db.issue.classhelp(columns,
                                      property=name)" />
</td>

<td metal:define-macro="search_select">
  <select tal:attributes="name name"
          tal:define="value python:request.form.getvalue(name)">
    <option value="">don't care</option>
    <tal:block metal:define-slot="extra_options"></tal:block>
    <option value="">------------</option>
    <option tal:repeat="s python:db[db_klass].list()"
            tal:attributes="value s/id; selected python:value == s.id"
            tal:content="python:s[db_content]"></option>
  </select>
</td>

<td metal:define-macro="search_checkboxes">
 <ul class="search-checkboxes"
     tal:define="value python:request.form.getvalue(name)">
 <li tal:repeat="s python:db[db_klass].list()">
  <input type="checkbox" tal:attributes="name name; id string:name-${s/id};
    value s/id; checked python:value == s.id" />
  <label tal:attributes="for string:$name-${s/id}" tal:content="s/name" />
 </li>
 <li metal:define-slot="no_value_item">
  <input type="checkbox" value="-1" tal:attributes="name name;
     id string:$name--1; checked python:value == '-1'" />
  <label tal:attributes="for string:$name--1">no value</label>
 </li>
 </ul>
</td>

<td metal:define-macro="column_input">
  <input type="checkbox" name="@columns"
         tal:attributes="value name;
                         checked python:name in cols">
</td>

<td metal:define-macro="sort_input">
  <input type="radio" name="@sort"
         tal:attributes="value name;
                         checked python:name == sort_on">
</td>

<td metal:define-macro="group_input">
  <input type="radio" name="@group"
         tal:attributes="value name;
                         checked python:name == group_on">
</td>
<!-- SHA: 9defd15b86478f539e44f06b9548340e239d7320 -->
