<tal:block metal:use-macro="templates/page/macros/icing">
<title metal:fill-slot="head_title" tal:content="Classname" />

<tal:block metal:fill-slot="create_or_query">
 <tal:block 
  metal:use-macro="templates/page/macros/create_or_query_new_tracker_item" />
</tal:block>

<tal:block metal:fill-slot="content">
 <tal:block tal:define=
  " batch request/batch
  ; pdict python: utils.properties_dict (db, context)
  ; pdict python: dict
    ( user   = utils.ExtProperty (utils, pdict ['user'],   multiselect = 1)
    , date   = utils.ExtProperty (utils, pdict ['date'])
    , status = utils.ExtProperty (utils, pdict ['status'], multiselect = 1)
    )
  ; props python: pdict.itervalues ()
  " tal:condition="context/is_view_ok">
  <tal:block tal:condition="not:context/is_view_ok">
   You are not allowed to view this page.
  </tal:block>
  <form method="GET" name="query" tal:attributes="action request/classname">
   <tal:block tal:replace="structure python:request.indexargs_form
    (sort='date', group='user', filter=1, filterspec=1, columns=0)"/>
  </form>

  <form method="POST" tal:attributes="action request/classname">
   <tal:block tal:define="batch request/batch"
              tal:condition="context/is_view_ok">
    <table class="list">
     <tr>
      <th i18n:translate="">user</th>
      <th i18n:translate="">date</th>
      <th i18n:translate="">status</th>
     </tr>
     <tr>
      <th i18n:translate="">start</th>
      <th i18n:translate="">end</th>
      <th i18n:translate="">duration</th>
      <th i18n:translate="">wp</th>
      <th i18n:translate="">time_activity</th>
      <th i18n:translate="">work_location</th>
     </tr>
     <tr>
      <th i18n:translate="" colspan="6">comment</th>
     </tr>
     <tal:block tal:repeat="i batch">
      <tal:block
       tal:define="class python:['normal','alt'][repeat['i'].index%2]
                  ;idx   python:repeat['i'].index + 1
                  ">
       <tr tal:attributes="class class">
        <td tal:content="structure python:i ['date'].pretty ('%a')"/>
        <tal:block tal:repeat="p python:['user','status']">
         <td tal:content="structure python:pdict [p].as_listentry (i)"/>
        </tal:block>
        <td/><td/><td/>
       </tr>
       <tal:block tal:repeat="r python: i ['time_record']">
        <tr tal:attributes="class class">
         <td tal:repeat="pn python:['start','end','duration']">
          <tal:block tal:replace="structure python: r [pn].field (5)"/>
         </td>
         <td>
          <select
           tal:attributes="name python:'time_record%s@wp'%r.id">
           <option selected="selected" value="-1">- no selection -</option>
           <option tal:repeat="wp python:db.time_wp.filter
              (filterspec = {'bookers' : db._db.getuid ()})"
             tal:content="python:' '.join
              ([str (wp [i]) for i in 'name','wp_no','project'])"/>
          </select>
         </td>
         <td tal:repeat="pn python:['time_activity','work_location']">
          <tal:block tal:replace="structure python: r [pn].menu ()"/>
         </td>
        </tr>
       </tal:block>
       <tr tal:condition="python: 1"
           tal:attributes="class class">
        <td tal:repeat="pn python:['start','end','duration']">
         <tal:block tal:replace="structure python:utils.new_property
          (context, db, 'time_record', -idx, pn).field (5)"/>
        </td>
        <td>
         <select
          tal:attributes="name python:'time_record-%d@wp'%idx">
          <option selected="selected" value="-1">- no selection -</option>
          <option tal:repeat="wp python:db.time_wp.filter
             (filterspec = {'bookers' : db._db.getuid ()})"
            tal:content="python:' '.join
             ([str (wp [i]) for i in 'name','wp_no','project'])"/>
         </select>
        </td>
        <td tal:repeat="pn python:['time_activity','work_location']">
         <tal:block tal:replace="structure python:utils.new_property
           (context, db, 'time_record', -idx, pn).menu ()"/>
        </td>

        <input type="hidden"
         tal:attributes="name  python:'time_record-%d@daily_record'%idx
                        ;value python:i.id
                        "/>
       </tr>
      </tal:block>
     </tal:block>
     <tr><td colspan="5"/>
      <td>
       <input type="submit" value=" Save " i18n:attributes="value">
       <input type="hidden" name="@action" value="daily_record_edit_action">
       <input type="hidden" name="@template" value="edit">
      </td>
     </tr>
    </table>
   </tal:block>
  </form>

  <tal:block metal:use-macro="templates/page/macros/ttt_search_form">
   <tal:block metal:fill-slot="query_title">Query Announcements</tal:block>
  </tal:block>
 </tal:block>
</tal:block>
</tal:block>
