<tal:block metal:use-macro="templates/page/macros/icing">
 <title metal:fill-slot="head_title">
  <tal:block tal:condition="context/id" i18n:translate="">
   <span tal:replace="string:${Classname}: ${context/id}"
    i18n:name="classname_id"/>
   created by
   <span tal:replace="context/creator" i18n:name="creator"/>
  </tal:block>
  <tal:block tal:condition="not:context/id" i18n:translate="">New
   <span tal:replace="Classname" i18n:name="Classname" />
  </tal:block>
 </title>
 <tal:block metal:fill-slot="create_or_query">
   <tal:block 
    metal:use-macro="templates/page/macros/create_or_query_new_tracker_item" />
 </tal:block> 

 <span metal:fill-slot="body_title" tal:omit-tag="python:1"
       tal:content="Classname"></span>

 <tal:block metal:fill-slot="content">
  <tal:block tal:define=
   " use_labelprop       python: True
   ; msg_box_height      python: 3
   ; has_nosy            python: False
   ; required_attributes python:'currency,customer_status,supplier_status'
   ">
   <tal:block metal:use-macro="templates/page/macros/formatted_class">
    <tal:block metal:fill-slot="formatted_class_content">
     <tr>
      <th tal:content="structure python:utils.fieldname
          (classname, 'description')"/>
      <td tal:content="structure python:context.description.field (size=60)"
          colspan="3"/>
     </tr>
     <tr tal:condition="context/id">
      <th tal:content="structure python:utils.fieldname
          (classname, 'invoice_address')"/>
      <td colspan="3">
       <span tal:content="structure python:context.invoice_address.field
             (size=6)"/>
       <span tal:condition="context/invoice_address">
        <a i18n:translate="" tal:attributes="href python:
           'address%s' % context.invoice_address.id">
         <span nowrap
          tal:content="python: ' '.join
           (( context.invoice_address.firstname.plain ()
           ,  context.invoice_address.lastname.plain ()
           ))"/>
         <span nowrap
          tal:content="python: ' '.join
           (context.invoice_address.function.plain ().split ('\n')[:1])"/>
        </a>
       </span>
       <span tal:condition="not:context/invoice_address">
        <input type="button" tal:attributes=
           "onClick python:'javascript:document.location =
            \'%s?@attr=invoice_address&@action=create_new_address\''
            % context.designator ()"
           i18n:attributes="value" value="new invoice address">
       </span>
      </td>
     </tr>
     <tr>
      <th tal:content="structure python:utils.fieldname
          (classname, 'contact_persons')"/>
      <td colspan="3">
       <table class="form" border="0"
              style="border-spacing:0px;padding-top:0px;padding-left:0px">
        <tr>
         <th style="text-align:left;padding-top:0px">
          <span tal:content="structure python:utils.fieldname
             ('address', 'firstname')"/>
          /
          <span tal:content="structure python:utils.fieldname
             ('address', 'lastname')"/>
          /
          <span tal:content="structure python:utils.fieldname
             ('address', 'function')"/>
         <th style="text-align:left;padding-top:0px"
             tal:condition="context/is_edit_ok" i18n:translate=""
             style="padding-top:0px">
             remove
         </th>
        </tr>
        <tr tal:repeat="ca python:sorted
            ( context.contact_persons
            , key = lambda x : (x.firstname, x.lastname, x.function)
            )">
         <td>
          <span>
           <a i18n:translate="" tal:attributes="href python:
              'address%s' % ca.id">
            <span nowrap
             tal:content="python: ' '.join
              (( ca.firstname.plain ()
              ,  ca.lastname.plain ()
              ))"/>
            <span nowrap
             tal:content="python: ' '.join
              (ca.function.plain ().split ('\n')[:1])"/>
           </a>
          </span>
         </td>
         <td tal:condition="context/is_edit_ok">
          <input type="checkbox" name="@remove@contact_persons"
                 tal:attributes="value ca/id">
         </td>
        </tr>
        <tr>
         <td colspan="2">
          <span>
           <input type="text" name="anonymous" size="6" onchange="
            document.forms.itemSynopsis ['@link@contact_persons'].value
            = 'address' + document.forms.itemSynopsis.anonymous.value;">
           <input type="hidden" name="@link@contact_persons">
           <input tal:condition="context/shipping_address"
             type="button" tal:attributes=
              "onClick python:'javascript:document.location = '
               '\'%s?@attr=contact_persons&@frm=shipping_address&'
               '@action=create_new_address\''
               % context.designator ()"
             i18n:attributes="value" value="new contact from shipping address">
           <input tal:condition="context/invoice_address"
             type="button" tal:attributes=
              "onClick python:'javascript:document.location = '
               '\'%s?@attr=contact_persons&@frm=invoice_address&'
               '@action=create_new_address\''
               % context.designator ()"
             i18n:attributes="value" value="new contact from invoice address">
          </span>
         </td>
        </tr>
       </table>
      </td>
     </tr>
     <tr>
      <th tal:content="structure python:utils.fieldname (classname, 'tax_id')"/>
      <td tal:content="structure python:context.tax_id.field ()"/>
      <th tal:content="structure python:utils.fieldname
          (classname, 'pharma_ref')"/>
      <td tal:content="structure python:context.pharma_ref.menu ()"/>
     </tr>
     <tr>
      <th tal:content="structure python:utils.fieldname
          (classname, 'dispatch_type')"/>
      <td tal:content="structure python:context.dispatch_type.menu ()"/>
      <th tal:content="structure python:utils.fieldname
          (classname, 'invoice_dispatch')"/>
      <td tal:content="structure python:context.invoice_dispatch.menu ()"/>
     </tr>
     <tr>
      <th class="required" tal:content="structure python:utils.fieldname
          (classname, 'currency')"/>
      <td tal:content="structure python:context.currency.menu ()"/>
     </tr>
     <tr>
      <th tal:content="structure python:utils.fieldname
          (classname, 'bank_account')"/>
      <td colspan="3">
       <table class="form" border="0"
              style="border-spacing:0px;padding-top:0px;padding-left:0px">
        <tr>
         <th style="text-align:left;padding-top:0px;padding-left:0px"
             class="required" tal:content="structure python:utils.fieldname
             (classname, 'bank')"/>
         <th style="text-align:left;padding-top:0px"
             tal:content="structure python:utils.fieldname
             (classname, 'bank_code')"/>
         <th style="text-align:left;padding-top:0px"
             tal:content="structure python:utils.fieldname
             (classname, 'act_number')"/>
         <th style="text-align:left;padding-top:0px"
             tal:content="structure python:utils.fieldname
             (classname, 'bic')"/>
         <th style="text-align:left;padding-top:0px"
             tal:content="structure python:utils.fieldname
             (classname, 'iban')"/>
         <th style="text-align:left;padding-top:0px"
             tal:condition="context/is_edit_ok" i18n:translate=""
             style="padding-top:0px">
             remove
         </th>
        </tr>
        <tr tal:repeat="bnk python:sorted
            (context.bank_account, key = lambda x : x.bank)">
         <td style="padding-left:0px"
             tal:content="structure python:utils.ExtProperty
             (utils, bnk.bank, item = bnk).formatlink ()"/>
         <td tal:content="structure python:bnk.bank_code.plain ()"/>
         <td tal:content="structure python:bnk.act_number.plain ()"/>
         <td tal:content="structure python:bnk.bic.plain ()"/>
         <td tal:content="structure python:bnk.iban.plain ()"/>
         <td tal:condition="context/is_edit_ok">
          <input type="checkbox" name="@remove@bank_account"
                 tal:attributes="value bnk/id">
         </td>
        </tr>
        <tr>
         <td style="padding-left:0px"
             tal:content="structure python:utils.new_property
             (context, db, 'bank_account', -1, 'bank').field (size=20)"/>
         <td tal:content="structure python:utils.new_property
             (context, db, 'bank_account', -1, 'bank_code').field (size=10)"/>
         <td tal:content="structure python:utils.new_property
             (context, db, 'bank_account', -1, 'act_number').field (size=15)"/>
         <td tal:content="structure python:utils.new_property
             (context, db, 'bank_account', -1, 'bic').field (size=15)"/>
         <td tal:content="structure python:utils.new_property
             (context, db, 'bank_account', -1, 'iban').field (size=15)"/>
         <input type="hidden" name="@link@bank_account" value="bank_account-1"/>
        </tr>
       </table>
      </td>
     </tr>
     <tr><td>&nbsp;</td></tr>
     <tr>
      <th class="required" tal:content="structure python:utils.fieldname
          (classname, 'customer_status')"/>
      <td tal:content="structure python:context.customer_status.menu ()"/>
     </tr>
     <tal:block tal:condition="python:
         (   context.id
         and context.customer_status
         and (context.customer_status.valid or context.customer_status.display)
         )">
      <tr>
       <th tal:content="structure python:utils.fieldname
           (classname, 'shipping_address')"/>
       <td colspan="3">
        <span tal:content="structure python:context.shipping_address.field
              (size=6)"/>
        <span tal:condition="context/shipping_address">
         <a i18n:translate="" tal:attributes="href python:
            'address%s' % context.shipping_address.id">
          <span nowrap
           tal:content="python: ' '.join
            (( context.shipping_address.firstname.plain ()
            ,  context.shipping_address.lastname.plain ()
            ))"/>
          <span nowrap
           tal:content="python: ' '.join
            (context.shipping_address.function.plain ().split ('\n')[:1])"/>
         </a>
        </span>
        <span tal:condition="not:context/shipping_address">
         <input tal:condition="context/invoice_address"
            type="button" tal:attributes=
            "onClick string:javascript:
            document.forms.itemSynopsis.shipping_address.value
            = document.forms.itemSynopsis.invoice_address.value"
            i18n:attributes="value" value="copy invoice address">
         <input type="button" tal:attributes=
            "onClick python:'javascript:document.location =
             \'%s?@attr=shipping_address&@action=create_new_address\''
             % context.designator ()"
            i18n:attributes="value" value="new shipping address">
        </span>
       </td>
      </tr>
      <tr>
       <th class="required" tal:content="structure python:utils.fieldname
           (classname, 'customer_group')"/>
       <td tal:content="structure python:context.customer_group.menu ()"/>
       <th tal:content="structure python:utils.fieldname
           (classname, 'attendant')"/>
       <td>
        <tal:block tal:content="structure python:context.attendant.field ()"/>
        <tal:block tal:replace="structure python:db.user.classhelp
             ( 'username,realname'
             , property='attendant'
             , inputtype='radio'
             , width='600'
             , pagesize=500
             )"/>
       </td>
      </tr>
      <tr>
       <th tal:content="structure python:utils.fieldname
           (classname, 'credit_limit')"/>
       <td>
        <span tal:content="structure python:context.credit_limit.field (10)"/>
        &nbsp;
        <span tal:condition="context/id" tal:content="context/currency"/>
       </td>
      </tr>
      <tr>
       <th tal:content="structure python:utils.fieldname
           (classname, 'discount_group')"/>
       <td tal:content="structure python:context.discount_group.menu ()"/>
       <th tal:content="structure python:utils.fieldname
           (classname, 'sales_conditions')"/>
       <td tal:content="structure python:context.sales_conditions.menu ()"/>
      </tr>
      <tr>
       <th tal:content="structure python:utils.fieldname
           (classname, 'invoice_text')"/>
       <td tal:content="structure python:context.invoice_text.field (size=80)"
           colspan="3"/>
      </tr>
     </tal:block>
     <tr><td>&nbsp;</td></tr>
     <tr>
      <th class="required" tal:content="structure python:utils.fieldname
          (classname, 'supplier_status')"/>
      <td tal:content="structure python:context.supplier_status.menu ()"/>
     </tr>
     <tal:block tal:condition="python:
         (   context.id
         and context.supplier_status
         and (context.supplier_status.valid or context.supplier_status.display)
         )">
      <tr>
       <th class="required" tal:content="structure python:utils.fieldname
           (classname, 'supplier_group')"/>
       <td tal:content="structure python:context.supplier_group.menu ()"/>
      </tr>
      <tr>
       <th tal:content="structure python:utils.fieldname
           (classname, 'order_text')"/>
       <td tal:content="structure python:context.order_text.field (size=80)"
           colspan="3"/>
      </tr>
     </tal:block>
     <tr><td>&nbsp;</td></tr>
    </tal:block>
   </tal:block>
  </tal:block>
 </tal:block>
</tal:block>
