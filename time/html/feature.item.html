<tal:block metal:use-macro="templates/page/macros/icing">

 <title metal:fill-slot="head_title">
  <span tal:condition="context/id"
        tal:replace="string:Feature: ${context/id} by ${context/creator}"></span>
  <span tal:condition="not:context/id"
        tal:replace="string:Create New Feature"></span>
 </title>

 <tal:block metal:fill-slot="content">
  <tal:block metal:use-macro="templates/page/macros/ttt_issue">
   <tal:block metal:fill-slot="ttt_issue_content">
    <tr>
     <th>Release</th>
     <td colspan="3">
      <span tal:content="structure context/release/menu"></span>
      <a tal:condition="context/release/id|nothing"
         tal:attributes="href context/release/designator"
         tal:content="context/release/title/plain"></a>
     </td>
    </tr>

    <tr tal:condition="context/id">
     <th>Status</th>
     <td colspan="3">
      <select name="status"
              tal:define="ok context/status/transitions">
       <option tal:attributes="value context/status/id"
               tal:content="context/status/name"></option>
       <tal:block tal:repeat="state db/feature_status/list">
       <option tal:condition="python:state.id in ok"
               tal:attributes="
                   value state/id;
                selected python:state.id == context.status.id"
               tal:content="state/name">
       </option>
       </tal:block>
      </select>
     </td>
    </tr>

    <tr tal:condition="python:[t for t in context.testcases.reverse ()
                              if t.status.plain () == 'accepted']">
     <th>Test OK</th>
     <td colspan="3" tal:condition="context/test_ok/_value"
         class="test_ok">All testcases passed !</td>
     <td colspan="3" tal:condition="not:context/test_ok/_value"
         class="test_failed">Some testcases failed - see below !!!</td>
    </tr>

    <tr>
     <th>Stakeholder</th>
     <td colspan="3">
      <textarea tal:content="context/stakeholder/plain"
                name="stakeholder"
                wrap="hard"
                rows="3"
                cols="80"></textarea>
     </td>
    </tr>

    <tr>
     <th>Depends on</th>
     <td colspan="3">
      <span tal:content="structure context/depends/field"/>
      <span tal:replace="structure python:db.feature.classhelp
                                             ( 'id,title,responsible'
                                             , property='depends'
                                             , width='600')" />
      <br>
      <tal:block tal:repeat="f context/depends">
       <a tal:attributes="href f/designator;
                          class string:feature_${f/status/plain};
                          title f/status/plain"
          tal:content="string:${f/title}"
       ></a><br>
      </tal:block>
     </td>
    </tr>

    <tr>
     <th>Needs</th>
     <td colspan="3">
      <span tal:content="structure context/needs/field"/>
      <span tal:replace="structure python:db.feature.classhelp
                                             ( 'id,title,responsible'
                                             , property='needs'
                                             , width='600')" />
      <br>
      <tal:block tal:repeat="f context/needs">
       <a tal:attributes="href f/designator;
                          class string:feature_${f/status/plain};
                          title f/status/plain"
          tal:content="string:${f/title} - ${f/status} - ${f/release}"
       ></a><br>
      </tal:block>
     </td>
    </tr>

    <tr tal:condition="context/release/plain">
     <th>Tracking</th>
     <td colspan="3">
      <table>
       <tr>
        <th>&nbsp;</th>
        <th>planned</th>
        <th>actual</th>
        <th>delay</th>
       </tr>
       <tr>
        <th>begin</th>
        <td tal:content="context/planned_begin"></td>
        <td tal:content="context/actual_begin"></td>
        <td>XXX</td>
       </tr>
       <tr>
        <th>end</th>
        <td tal:content="context/planned_end"></td>
        <td tal:content="context/actual_end"></td>
        <td>XXX</td>
       </tr>
      </table>
     </td>
    </tr>

    <tr tal:condition="context/id"
        tal:define="available python:[]">
     <th>Documents</th>
     <td colspan="3">
      <table class="files"
             tal:condition="context/documents">
       <tr>
        <th>Type</th>
        <th>Status</th>
        <th>Responsible</th>
       </tr>
       <tr tal:repeat="doc context/documents/reverse">
        <td tal:define="_xx python:available.append(doc.type.id)">
         <a tal:attributes="href doc/designator"
            tal:content="doc/type/description"></a>
        </td>
        <td tal:content="doc/status/plain"></td>
        <td tal:content="doc/responsible/plain"></td>
       </tr>
      </table>
      <table border="0">
       <tr>
        <th>Add new with type:</th>
        <td>
         <select name="design_document-1@type">
          <option selected="selected" value="-1">- select Design Document Type -</option>
          <tal:block tal:repeat="t db/design_document_type/list">
          <option tal:condition="python:t.id not in available"
                  tal:attributes="value t/id"
                  tal:content="string:${t/description} (${t/name})"></option>
          </tal:block>
         </select>
        </td>
       </tr>
      </table>
      <input type="hidden" name="@link@documents" value="design_document-1" />
     </td>
    </tr>

    <tr tal:condition="context/id">
     <th>Implementation</th>
     <td colspan="3">
      <table class="files"
             tal:condition="context/implementation_tasks">
       <tr>
        <th>Title</th>
        <th>Status</th>
        <th>Responsible</th>
       </tr>
       <tr tal:repeat="task context/implementation_tasks">
        <td><a tal:attributes="href task/designator"
               tal:content="task/title|string:[no title]"
               target="implementation_task"></a>
        </td>
        <td tal:content="task/status/plain"></td>
        <td tal:content="task/responsible/plain"></td>
       </tr>
      </table>
      <table border="0">
       <tr>
        <th>Add new with title:</th>
        <td>
         <input type="text" name="implementation_task-1@title" size="50">
        </td>
       </tr>
      </table>
      <input type="hidden" name="@link@implementation_tasks"
             value="implementation_task-1" />
     </td>
    </tr>

    <tr tal:condition="context/id">
     <th>Testcases</th>
     <td colspan="3">
      <table class="files"
             tal:condition="context/testcases">
       <tr>
        <th>Title</th>
        <th>Status</th>
        <th>Responsible</th>
       </tr>
       <tr tal:repeat="task context/testcases">
        <td><a tal:attributes="href task/designator;
                               class string:wp_${task/status/plain}_${task/test_ok/plain}"
               tal:content="task/title"
               target="testcase"></a>
        </td>
        <td tal:content="task/status/plain"></td>
        <td tal:content="task/responsible/plain"></td>
       </tr>
      </table>
      <table border="0">
       <tr>
        <th>Add new with title:</th>
        <td>
         <input type="text" name="testcase-1@title" size="50">
        </td>
       </tr>
      </table>
      <input type="hidden" name="@link@testcases" value="testcase-1" />
     </td>
    </tr>

    <tr tal:condition="context/id">
     <th>Documentation</th>
     <td colspan="3">
      <table class="files"
             tal:condition="context/documentation_tasks">
       <tr>
        <th>Title</th>
        <th>Status</th>
        <th>Responsible</th>
       </tr>
       <tr tal:repeat="task context/documentation_tasks">
        <td><a tal:attributes="href task/designator"
               tal:content="task/title|string:[no title]"></a>
        </td>
        <td tal:content="task/status/plain"></td>
        <td tal:content="task/responsible/plain"></td>
       </tr>
      </table>
      <table border="0">
       <tr>
        <th>Add new with title:</th>
        <td>
         <input type="text" name="documentation_task-1@title" size="50">
        </td>
       </tr>
      </table>
      <input type="hidden" name="@link@documentation_tasks"
             value="documentation_task-1" />
     </td>
    </tr>


   </tal:block>
  </tal:block>
 </tal:block>

</tal:block>
