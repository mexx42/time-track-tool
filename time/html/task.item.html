<tal:block metal:use-macro="templates/page/macros/icing">

 <title metal:fill-slot="head_title">
  <span tal:condition="context/id"
        tal:replace="string:Task: ${context/id} by ${context/creator}"></span>
  <span tal:condition="not:context/id"
        tal:replace="string:Create New Task"></span>
 </title>

 <tal:block metal:fill-slot="content">
  <tal:block metal:use-macro="templates/page/macros/ttt_issue">
   <tal:block metal:fill-slot="ttt_issue_content">
    <tr>
     <th>Status</th>
     <td>
      <select name="status"
              tal:define="ok context/status/transitions">
       <option tal:attributes="value context/status/id"
               tal:content="context/status/name"></option>
       <tal:block tal:repeat="state db/task_status/list">
       <option tal:condition="python:state.id in ok"
               tal:attributes="
                   value state/id;
                selected python:state.id == context.status.id"
               tal:content="state/name">
       </option>
       </tal:block>
      </select>
     </td>
    </tr>

    <tr>
     <th>Kind</th>
     <td>
      <select name="kind">
       <option tal:repeat="k db/task_kind/list"
               tal:attributes="value k/id;
                               selected python:k.id == context.kind.id"
               tal:content="k/description">
       </option>
      </select>
     </td>
    </tr>

    <tr tal:condition="python:(context.kind.plain () == 'testcase')
                          and (context.status.plain () == 'accepted')">
     <th>Test Ok</th>
     <td tal:condition="context/is_edit_ok"
         tal:content="structure context/test_ok/field">
     </td>
     <td tal:condition="not:context/is_edit_ok"
         tal:content="context/test_ok">
     </td>
    </tr>

    <tr>
     <th>Part of</th>
     <td><a tal:attributes="href context/feature/designator;
                            class string:feature_${context/feature/status}"
            tal:content="context/feature/title"></a>
     </td>
    </tr>

    <tr>
     <th>Depends on</th>
     <td colspan="3">
      <span tal:content="structure context/depends/field"/>
      <span tal:replace="structure python:db.task.classhelp
                                             ( 'id,title,responsible'
                                             , property='depends'
                                             , width='600')" /><br>
      <tal:block tal:repeat="f context/depends">
       <a tal:attributes="href f/designator;
                          class string:task_${f/status/plain};
                          title f/status/plain"
          tal:content="string:${f/title}"
       ></a><br>
      </tal:block>
     </td>
    </tr>

    <tr>
     <th>Needs</th>
     <td colspan="3">
      <span tal:content="structure context/needs/field"/>
      <span tal:replace="structure python:db.task.classhelp
                                             ( 'id,title,responsible'
                                             , property='needs'
                                             , width='600')" /><br>
      <tal:block tal:repeat="f context/needs">
       <a tal:attributes="href f/designator;
                          class string:work_package_${f/status/plain};
                          title f/status/plain"
          tal:content="string:${f/title}"
       ></a><br>
      </tal:block>
     </td>
    </tr>

    <tr tal:condition="context/defects">
     <th>Defects</th>
     <td>
      <span tal:repeat="def context/defects">
       <a tal:attributes="href def/designator;"
          tal:content="def/title"></a><br>
      </span>
     </td>
    </tr>

    <tr>
     <th>Effort</th>
     <td tal:content="structure context/effort/field"></td>
    </tr>

    <tal:block tal:condition="context/planned_begin">
    <tr>
     <th>Planned</th>
     <td>
      <span tal:content="context/planned_begin"></span>
      <span tal:content="context/planned_end"></span>
     </td>
    </tr>

    <tr>
     <th>Actual</th>
     <td>
      <span tal:content="context/actual_begin"></span>
      <span tal:content="context/actual_end"></span>
     </td>
    </tr>

    <tr>
     <th>Estimated</th>
     <td>
      <span tal:content="structure context/estimated_begin/field"></span>
      <span tal:content="structure context/estimated_end/field"></span>
     </td>
    </tr>
    </tal:block>

    <tr>
     <th>Files</th>
     <td colspan="3">
      <tal:block metal:use-macro="templates/page/macros/ttt_issue_files"/>
     </td>
    </tr>
   </tal:block>
  </tal:block>
 </tal:block>

</tal:block>
