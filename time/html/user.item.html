<!-- dollarId: user.item,v 1.7 2002/08/16 04:29:04 richard Exp dollar-->
<tal:block metal:use-macro="templates/page/macros/icing">
<title metal:fill-slot="head_title">
<span tal:condition="context/id"
      tal:replace="string:User ${context/id}: ${context/username}" />
<tal:x tal:condition="not:context/id">New User</tal:x>
- <span tal:replace="config/TRACKER_NAME" />
</title>
<span metal:fill-slot="body_title" tal:omit-tag="python:1">
  User<span tal:replace="context/id" />
   <tal:x tal:condition="context/is_edit_ok">Editing</tal:x>
</span>

<td class="content" metal:fill-slot="content">

<form method="POST" onSubmit="return submit_once()"
      name="user_form"
      enctype="multipart/form-data"
      tal:attributes="action context/designator">

<table class="form">
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'firstname')" />
  <td tal:content="structure context/firstname/field"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'lastname')" />
  <td tal:content="structure context/lastname/field"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'username')" />
  <td tal:content="structure context/username/field"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'nickname')" />
  <td tal:content="structure context/nickname/field"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'is_alias')" />
  <td tal:content="structure context/is_alias/field"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'title')" />
  <td tal:content="structure context/title/menu"></td>
 </tr>
 <tr tal:condition="context/is_edit_ok">
  <th tal:content="structure python:utils.fieldname('user', 'password')" />
  <td tal:content="structure context/password/field"></td>
 </tr>
 <tr tal:condition="context/is_edit_ok">
  <th tal:content="structure python:utils.fieldname('user', 'confirm')" />
  <td tal:content="structure context/password/confirm"></td>
 </tr>
 <tr tal:condition="python:request.user.hasPermission('Web Roles')">
  <th tal:content="structure python:utils.fieldname('user', 'roles')" />
  <td>
   <input tal:condition="context/id"
          tal:replace="structure context/roles/field">
   <input name="roles" tal:condition="not:context/id"
          tal:attributes="value db/config/NEW_WEB_USER_ROLES">
   <br>(to give the user more than one role, enter a comma,separated,list)
  </td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'phone')" />
  <td tal:content="structure context/phone/field"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'external_phone')"/>
  <td tal:content="structure context/external_phone/field"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'private_phone')"/>
  <td tal:content="structure context/private_phone/field"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'organisation')"/>
  <td tal:content="structure context/organisation/menu"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'location')"/>
  <td tal:content="structure context/location/field"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'room')"/>
  <td tal:content="structure context/room/menu"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'department')"/>
  <td tal:content="structure context/department/menu"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'position')"/>
  <td tal:content="structure context/position/menu"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'superior')"/>
  <td>
   <tal:block tal:define="name      string:superior;
                          form      string:user_form;
                          dont_care string:don't care;
                          selected  context/superior/id | string:0">
    <tal:block metal:use-macro="templates/userlist/macros/user"></tal:block>
   </tal:block>
  </td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'substitutes')"/>
  <td>
   <tal:block tal:define="size      string:7;
                          name      string:substitutes;
                          form      string:user_form;
                          dont_care string:don't care;
                          selected  python:str([u.id for u in context.substitutes.reverse ()] or [''])[1:-1]">
    <tal:block metal:use-macro="templates/userlist/macros/user_multi"></tal:block>
   </tal:block>
  </td>
 </tr>
 <tr>
  <th tal:content="structure
      python:utils.fieldname('user', 'job_description')"/>
  <td tal:content="structure context/job_description/multiline"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'timezone')"/>
  <td>
   <input tal:replace="structure context/timezone/field">
   <br>(this is a numeric hour offset, the default is
   <span tal:replace="db/config/DEFAULT_TIMEZONE" />)
  </td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname ('user', 'address')"/>
  <td tal:content="structure context/address/field">address</td>
 </tr>
 <tr>
  <th tal:content="structure
      python:utils.fieldname ('user', 'alternate_addresses')"/>
  <td tal:content="structure context/alternate_addresses/multiline">alternate_addresses</td>
 </tr>
 <tr tal:condition="context/is_edit_ok">
  <th tal:content="structure python:utils.fieldname ('user', 'pictures')"/>
  <td>
   <input type="file"   name="file-1@content" size="40">
   <input type="hidden" name="@link@pictures" value="file-1">
  </td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname ('user', 'lunch_start')"/>
  <td tal:content="structure context/lunch_start/field"></td>
 </tr>
 <tr>
  <th tal:content="structure
      python:utils.fieldname ('user', 'lunch_duration')"/>
  <td tal:content="structure context/lunch_duration/field"></td>
 </tr>

 <tr>
  <th tal:content="structure python:utils.fieldname ('user', 'queries')"/>
  <td tal:content="structure context/queries/field"></td>
 </tr>

 <tr tal:condition="context/is_edit_ok">
  <td>
   &nbsp;
   <input type="hidden" name="@template" value="item">
   <input type="hidden" name="@required" value="username,address">
  </td>
  <td>
   <span tal:content="structure context/submit"
         tal:condition="context/is_edit_ok" />
   <input type="button"
     tal:condition="python:context.id and context.is_view_ok()"
     tal:attributes=
      "onClick string:javascript:help_window('${context/designator}?@template=history','600','300')"
     value="History" i18n:attributes="value">
  </td>
 </tr>
</table>
</form>

<table class="files" tal:condition="context/pictures">
 <tr>
  <th colspan="4" class="header">pictures</th>
 </tr>
 <tr>
  <th>File name</th>
  <th>Uploaded</th>
  <th>Type</th>
  <th>Remove</th>
 </tr>
 <tr tal:repeat="file context/pictures">
  <td>
   <img tal:attributes="src file/download_url">
  </td>
  <td>
   <span tal:content="file/creator">creator's name</span>,
   <span tal:content="file/creation">creation date</span>
  </td>
  <td tal:content="file/type" />
  <td>
   <form style="padding:0"
         tal:condition="context/is_edit_ok"
         tal:attributes="action string:user${context/id}">
    <input type="hidden" name="@remove@pictures" tal:attributes="value file/id">
    <input type="hidden" name="@action" value="edit">
    <input type="submit" value="remove">
   </form>
  </td>
 </tr>
</table>

</td>

</tal:block>
