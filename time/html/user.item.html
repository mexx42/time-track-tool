<!-- dollarId: user.item,v 1.7 2002/08/16 04:29:04 richard Exp dollar-->
<tal:block metal:use-macro="templates/page/macros/icing">
<title metal:fill-slot="head_title">
 <tal:block i18n:translate="" tal:condition="context/id">
  User 
  <span tal:replace="string:${context/id}: ${context/username}" />
 </tal:block>
 <tal:block i18n:translate=""
  tal:condition="not:context/id">New User
 </tal:block>
</title>
<span metal:fill-slot="body_title" tal:omit-tag="python:1" i18n:translate="">
  <span tal:condition="not:context/id" i18n:translate="">New</span>
  User<span tal:replace="context/id" />
   <tal:x tal:condition="context/is_edit_ok" i18n:translate="">Editing</tal:x>
</span>

<tal:block metal:fill-slot="create_or_query">
 <tal:block 
  metal:use-macro="templates/page/macros/create_or_query_new_tracker_item" />
</tal:block>

<td class="content" metal:fill-slot="content">

<form method="POST" onSubmit="return submit_once()"
      name="user_form"
      enctype="multipart/form-data"
      tal:attributes="action context/designator">

<table class="form">
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'firstname')" />
  <td tal:content="structure context/firstname/field"></td>
  <td tal:condition="context/pictures" rowspan="9">
    <img width="112" alt="Photo" tal:attributes="src python:
     context.pictures.reverse().next ().download_url ()">
  </td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'lastname')" />
  <td tal:content="structure context/lastname/field"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'username')" />
  <td tal:content="structure context/username/field"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'nickname')" />
  <td tal:content="structure context/nickname/field"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'sex')" />
  <td tal:content="structure context/sex/menu"></td>
 </tr>
 <tal:block tal:condition="context/id">
 <tr tal:define="
   ud python:utils.act_or_latest_user_dynamic (db._db, context.id)"
  tal:condition="python:db.user_dynamic.is_view_ok () and ud">
  <th i18n:translate="">user_dynamic</th>
  <td>
    <a tal:attributes="href python:'user_dynamic%s' % ud.id">
    dynamic user record
    </a>
  </td>
 </tr>
 </tal:block>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'status')" />
  <td tal:content="structure context/status/menu"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'title')" />
  <td tal:content="structure context/title/field"></td>
 </tr>
 <tr tal:condition="python:context.is_edit_ok() and not context.sync_with_ldap">
  <th tal:content="structure python:utils.fieldname('user', 'password')" />
  <td tal:content="structure context/password/field"></td>
 </tr>
 <tr tal:condition="python:context.is_edit_ok() and not context.sync_with_ldap">
  <th tal:content="structure python:utils.fieldname('user', 'confirm')" />
  <td tal:content="structure context/password/confirm"></td>
 </tr>
 <tr tal:condition="context/roles/is_view_ok">
  <th tal:content="structure python:utils.fieldname('user', 'roles')" />
  <td>
   <input tal:condition="context/id"
          tal:replace="structure context/roles/field">
   <input name="roles" tal:condition="not:context/id"
          tal:attributes="value db/config/NEW_WEB_USER_ROLES">
  </td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'org_location')" />
  <td tal:condition="not:context/id"
   tal:content="structure context/org_location/menu"/>
  <td tal:condition="context/id"
   tal:content="structure python:utils.ExtProperty
    ( utils, context.org_location.name
    , item = context.org_location
    ).formatlink ()"/>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'department')" />
  <td tal:condition="not:context/id"
   tal:content="structure context/department/menu"/>
  <td tal:condition="context/id"
   tal:content="structure python:utils.ExtProperty
    ( utils, context.department.name
    , item = context.department
    ).formatlink ()"/>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'phone')" />
  <td tal:content="structure context/phone/field"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'external_phone')"/>
  <td tal:content="structure context/external_phone/field"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'private_phone')"/>
  <td tal:content="structure context/private_phone/field"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'room')"/>
  <td tal:content="structure context/room/menu"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'position')"/>
  <td tal:content="structure context/position/menu"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'supervisor')"/>
  <td>
   <tal:block tal:define="name      string:supervisor;
                          form      string:user_form;
                          dont_care string:don't care;
                          selected  context/supervisor/id | string:0">
    <tal:block metal:use-macro="templates/userlist/macros/user"></tal:block>
   </tal:block>
  </td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'substitute')"/>
  <td>
   <tal:block tal:define="name      string:substitute;
                          form      string:user_form;
                          dont_care string:don't care;
                          selected  context/substitute/id | string:0">
    <tal:block metal:use-macro="templates/userlist/macros/user"></tal:block>
   </tal:block>
  </td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'subst_active')"/>
  <td tal:content="structure context/subst_active/field"/>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'clearance_by')"/>
  <td tal:condition="context/clearance_by/is_edit_ok">
   <tal:block tal:define="name      string:clearance_by;
                          form      string:user_form;
                          dont_care string:don't care;
                          selected  context/clearance_by/id | string:0">
    <tal:block metal:use-macro="templates/userlist/macros/user"></tal:block>
   </tal:block>
  </td>
  <td tal:content="context/clearance_by/plain"
   tal:condition="not:context/clearance_by/is_edit_ok"/>
 </tr>
 <tr>
  <th tal:content="structure
      python:utils.fieldname('user', 'job_description')"/>
  <td tal:content="structure context/job_description/multiline"></td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname('user', 'timezone')"/>
  <td>
   <input tal:replace="structure context/timezone/field">
   default: 
   <span tal:replace="db/config/DEFAULT_TIMEZONE" />
  </td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname ('user', 'address')"/>
  <td tal:content="structure context/address/field">address</td>
 </tr>
 <tr>
  <th tal:content="structure
      python:utils.fieldname ('user', 'alternate_addresses')"/>
  <td tal:content="structure context/alternate_addresses/multiline">alternate_addresses</td>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname ('user', 'lunch_start')"/>
  <td tal:content="structure context/lunch_start/field"></td>
 </tr>
 <tr>
  <th tal:content="structure
      python:utils.fieldname ('user', 'lunch_duration')"/>
  <td tal:content="structure context/lunch_duration/field"></td>
 </tr>
 <tr tal:condition="context/sync_with_ldap/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'sync_with_ldap')"/>
  <td tal:content="structure context/sync_with_ldap/field"></td>
 </tr>
 <tr tal:condition="context/is_lotus_user/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'is_lotus_user')"/>
  <td tal:content="structure context/is_lotus_user/field"></td>
 </tr>
 <tr tal:condition="context/group/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'group')"/>
  <td>
   <tal:block tal:replace="structure context/group/field"/>
   <tal:block tal:replace="structure python:db.group.classhelp
    ( 'name,description'
    , property='group'
    , inputtype='radio'
    , width='600'
    , pagesize=1000 
    )"/>
  </td>
 </tr>
 <tr tal:condition="context/secondary_groups/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'secondary_groups')"/>
  <td>
   <tal:block tal:content="structure context/secondary_groups/field"/>
   <tal:block tal:replace="structure python:db.group.classhelp
    ( 'name,description'
    , property='secondary_groups'
    , width='600'
    , pagesize=1000 
    )"/>
  </td>
 </tr>
 <tr tal:condition="context/uid/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'uid')"/>
  <td tal:content="structure context/uid/field"></td>
 </tr>
 <tr tal:condition="context/home_directory/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'home_directory')"/>
  <td tal:content="structure context/home_directory/field"></td>
 </tr>
 <tr tal:condition="context/login_shell/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'login_shell')"/>
  <td tal:content="structure context/login_shell/field"></td>
 </tr>
 <tr tal:condition="context/samba_home_drive/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'samba_home_drive')"/>
  <td tal:content="structure context/samba_home_drive/field"></td>
 </tr>
 <tr tal:condition="context/samba_home_path/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'samba_home_path')"/>
  <td tal:content="structure context/samba_home_path/field"></td>
 </tr>
 <tr tal:condition="context/samba_kickoff_time/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'samba_kickoff_time')"/>
  <td tal:content="structure context/samba_kickoff_time/field"></td>
 </tr>
 <tr tal:condition="context/samba_logon_script/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'samba_logon_script')"/>
  <td tal:content="structure context/samba_logon_script/field"></td>
 </tr>
 <tr tal:condition="context/samba_profile_path/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'samba_profile_path')"/>
  <td tal:content="structure context/samba_profile_path/field"></td>
 </tr>
 <tr tal:condition="context/samba_pwd_can_change/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'samba_pwd_can_change')"/>
  <td tal:content="structure context/samba_pwd_can_change/field"></td>
 </tr>
 <tr tal:condition="context/samba_pwd_last_set/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'samba_pwd_last_set')"/>
  <td tal:content="structure context/samba_pwd_last_set/field"></td>
 </tr>
 <tr tal:condition="context/samba_pwd_must_change/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'samba_pwd_must_change')"/>
  <td tal:content="structure context/samba_pwd_must_change/field"></td>
 </tr>
 <tr tal:condition="context/shadow_used/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'shadow_used')"/>
  <td tal:content="structure context/shadow_used/field"></td>
 </tr>
 <tr tal:condition="context/shadow_last_change/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'shadow_last_change')"/>
  <td tal:content="structure context/shadow_last_change/field"></td>
 </tr>
 <tr tal:condition="context/shadow_min/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'shadow_min')"/>
  <td tal:content="structure context/shadow_min/field"></td>
 </tr>
 <tr tal:condition="context/shadow_max/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'shadow_max')"/>
  <td tal:content="structure context/shadow_max/field"></td>
 </tr>
 <tr tal:condition="context/shadow_warning/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'shadow_warning')"/>
  <td tal:content="structure context/shadow_warning/field"></td>
 </tr>
 <tr tal:condition="context/shadow_inactive/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'shadow_inactive')"/>
  <td tal:content="structure context/shadow_inactive/field"></td>
 </tr>
 <tr tal:condition="context/shadow_expire/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'shadow_expire')"/>
  <td tal:content="structure context/shadow_expire/field"></td>
 </tr>
 <tr tal:condition="context/samba_nt_password/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'samba_nt_password')"/>
  <td tal:content="structure context/samba_nt_password"></td>
 </tr>
 <tr tal:condition="context/samba_lm_password/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'samba_lm_password')"/>
  <td tal:content="structure context/samba_lm_password"></td>
 </tr>
 <tr tal:condition="context/user_password/is_view_ok">
  <th tal:content="structure
      python:utils.fieldname ('user', 'user_password')"/>
  <td tal:content="structure context/user_password"></td>
 </tr>
 <tr tal:condition="context/pictures/is_edit_ok">
  <th tal:content="structure python:utils.fieldname ('user', 'pictures')"/>
  <td>
   <input type="file"   name="file-1@content" size="40">
   <input type="hidden" name="@link@pictures" value="file-1">
  </td>
 </tr>

 <tr tal:condition="context/is_edit_ok">
  <td>
   &nbsp;
   <input type="hidden" name="@template" value="item">
   <input type="hidden" name="@required" value="">
  </td>
  <td>
   <span tal:content="structure context/submit"
         tal:condition="context/is_edit_ok" />
   <input type="button"
     tal:condition="python:context.id and context.is_view_ok()"
     tal:attributes=
      "onClick string:javascript:help_window('${context/designator}?@template=history','600','300')"
     value="History" i18n:attributes="value">
  </td>
 </tr>
</table>
</form>

<table class="files"
 tal:condition="python: context.pictures and context.pictures.is_edit_ok ()">
 <tr>
  <th colspan="4" class="header" i18n:translate="">pictures</th>
 </tr>
 <tr>
  <th tal:content="structure python:utils.fieldname ('file', 'name')"/>
  <th tal:content="structure python:utils.fieldname ('file', 'creation')"/>
  <th tal:content="structure python:utils.fieldname ('file', 'type')"/>
  <th tal:content="structure python:utils.fieldname ('file', 'remove')"/>
 </tr>
 <tr tal:repeat="file context/pictures">
  <td>
   <img width="112" tal:attributes="src file/download_url">
  </td>
  <td>
   <span tal:content="file/creator">creator's name</span>,
   <span tal:content="file/creation">creation date</span>
  </td>
  <td tal:content="file/type" />
  <td>
   <form style="padding:0"
         tal:condition="context/is_edit_ok"
         tal:attributes="action string:user${context/id}">
    <input type="hidden" name="@remove@pictures" tal:attributes="value file/id">
    <input type="hidden" name="@action" value="edit">
    <input type="submit" value="remove">
   </form>
  </td>
 </tr>
</table>

</td>

</tal:block>
