<tal:block metal:use-macro="templates/page/macros/icing">

 <title metal:fill-slot="head_title">
  <span tal:condition="context/id"
        tal:replace="string:${Classname}: ${context/id} angelegt von
                     ${context/creator}">
  </span>
  <span tal:condition="not:context/id" tal:replace="string:Neue Adresse"></span>
 </title>
 <tal:block metal:fill-slot="create_or_query">
   <tal:block
    metal:use-macro="templates/page/macros/create_or_query_new_tracker_item" />
 </tal:block>
 <span metal:fill-slot="body_title" tal:omit-tag="python:1"
       tal:content="Classname"/>
 <tal:block metal:fill-slot="menu_slot">
   <tr tal:condition="context/id">
     <td class="sidebar" nowrap colspan="2"
      tal:condition="python:request.user.hasPermission ('View','tmplate')">
      <span class="classblock">
       <select name="tmplates"
        onChange="javascript:document.location=document.forms['menubar'].elements['tmplates'].options[document.forms['menubar'].elements['tmplates'].options.selectedIndex].value;">

        <option value="" i18n:translate="">
        -- tmplates --
        </option>
        <tal:block tal:repeat="o python:db.tmplate.filter (sort=('+','name'))">
         <option tal:content="o/name"
          tal:attributes="value
           python:'address%s?:action=personalized_template&tmplate=%s' %
            (context.id, o.id)"/>
        </tal:block>
       </select>
      </span>
     </td>
     <td class="sidebar" nowrap tal:condition="python:'abo' in db._db.classes">
      <span class="classblock"
       tal:condition="python:request.user.hasPermission ('Edit','abo')">
       <a i18n:translate=""
          tal:attributes="href
          string:abo?:template=item&subscriber=${context/id}&payer=${context/id}">
        New Subscription for
        <tal:block i18n:name="lastname" tal:replace="context/lastname"/>
       </a>
      </span>
      <span class="classblock"
       tal:condition="python:request.user.hasPermission ('Edit','letter')">
       <a i18n:translate=""
          tal:attributes="href
          string:letter?:template=item&address=${context/id}">
        New Letter for
        <tal:block i18n:name="lastname" tal:replace="context/lastname"/>
       </a>
      </span>
     </td>
   </tr>
 </tal:block>

 <tal:block metal:fill-slot="content">
  <tal:block tal:define=
             " use_labelprop       python:0
             ; msg_box_height      python:4
             ; required_attributes string:street,country">
   <tal:block metal:use-macro="templates/page/macros/formatted_class">
    <tal:block metal:fill-slot="formatted_class_content">
     <tr>
      <th tal:content="structure python:utils.fieldname
          (classname, 'salutation')"/>
      <td tal:content="structure context/salutation/field"/>
      <tal:block tal:condition="python:'birthdate' in klass._klass.properties">
       <th tal:content="structure python:utils.fieldname
           (classname, 'birthdate')"/>
       <td colspan="2" tal:content="structure context/birthdate/field"/>
      </tal:block>
     </tr>
     <tr>
      <th tal:content="structure python:utils.fieldname(classname, 'title')"/>
      <td tal:content="structure context/title/field"/>
      <th tal:content="structure python:utils.fieldname
          (classname, 'lettertitle')"/>
      <td tal:content="structure context/lettertitle/field" colspan="2"/>
     </tr>
     <tr>
      <th tal:content="structure python:utils.fieldname
          (classname, 'firstname')"/>
      <td>
       <table border="0" cellspacing="0" cellpadding="0">
        <tr>
         <td tal:content="structure python:context.firstname.field (size=24)"/>
         <td tal:content="structure python:context.initial.field (size=3)"/>
        </tr>
       </table>
      </td>
      <th tal:content="structure python:utils.fieldname
          (classname, 'lastname')"/>
      <td tal:content="structure context/lastname/field" colspan="2"/>
     </tr>
     <tr>
      <th tal:content="structure python:utils.fieldname(classname, 'country')"
          class="required"/>
      <td>
       <table border="0" cellspacing="0" cellpadding="0">
        <tr>
         <td tal:content="structure python:context.country.field (size=4)"/>
         <td>&nbsp</td>
         <th tal:content="structure python:utils.fieldname
             (classname, 'postalcode')" class="required"/>
         <td tal:content="structure python:context.postalcode.field (size=10)"/>
        </tr>
       </table>
      </td>
      <th tal:content="structure python:utils.fieldname(classname, 'city')"
          class="required"/>
      <td tal:content="structure context/city/field" colspan="2"/>
     </tr>
     <tr>
      <th tal:content="structure python:utils.fieldname(classname, 'street')"
          class="required"/>
      <td tal:content="structure context/street/field"/>
      <th tal:content="structure python:utils.fieldname
          ('contact', 'contact_type')" class="required"/>
      <th style="text-align:left"
          tal:content="structure python:utils.fieldname
          ('contact', 'contact')" class="required"/>
      <th style="text-align:left"
          tal:content="structure python:utils.fieldname
          ('contact', 'description')"/>
      <th style="text-align:left"
          tal:condition="context/is_edit_ok" i18n:translate="">
          remove
      </th>
     </tr>
     <tr>
      <th tal:content="structure python:utils.fieldname(classname, 'function')"/>
      <td tal:attributes="rowspan python:1+len (context.contacts)">
       <textarea tal:content="context/function/plain"
                 name="function"
                 wrap="hard"
                 rows="3"
                 cols="30">
       </textarea>
      </td>
      <td tal:content="structure python:utils.new_property
          (context, db, 'contact', -1, 'contact_type').menu ()"/>
      <td tal:content="structure python:utils.new_property
          (context, db, 'contact', -1, 'contact').field (size=20)"/>
      <td tal:content="structure python:utils.new_property
          (context, db, 'contact', -1, 'description').field (size=14)"/>
      <input type="hidden" name="@link@contacts" value="contact-1"/>
     </tr>
     <tr tal:repeat="ct python:sorted
         (context.contacts, key = lambda x : (x.contact_type.name, x.contact))">
      <td colspan="2">
      <th style="vertical-align:top"
          tal:content="structure python:utils.ExtProperty
          (utils, ct.contact_type, item = ct).formatlink () + '&nbsp'"/>
      <td>
       <a tal:condition="python: ct.contact_type.url_template"
          tal:content="ct/contact/plain" tal:attributes="href python:
          ct.contact_type.url_template.plain () % ct"/>
       <span tal:condition="python: not ct.contact_type.url_template"
             tal:content="ct/contact/plain"/>
      </td>
      <td tal:content="ct/description/plain"/>
      <td tal:condition="context/is_edit_ok">
       <input type="checkbox" name="@remove@contacts"
              tal:attributes="value ct/id">
      </td>
     </tr>
     <tr>
      <th tal:content="structure python:utils.fieldname
          (classname, 'adr_type')"/>
      <td tal:define="tc python:','.join (db._db.adr_type_cat.getnodeids ())">
       <span tal:content="structure context/adr_type/field"/>
       <span tal:replace="structure python:utils.adr_type_classhelp (db)"/>
      </td>
      <th tal:content="structure python:utils.fieldname(classname, 'valid')"/>
      <td tal:content="structure context/valid/menu" colspan="2"/>
     </tr>
     <tr tal:condition="python:'opening_hours' in db._db.classes">
      <th tal:content="structure python:utils.fieldname
          (classname, 'opening_hours')"/>
      <td colspan="3">
       <table class="form" border="0"
              style="border-spacing:0px;padding-top:0px;padding-left:0px">
        <tr tal:repeat="oh python:sorted
            (context.opening_hours, key = lambda x : (x.weekday, x.from_hour))">
         <td style="padding-left:0px"
             tal:content="structure python:utils.ExtProperty
             (utils, oh.weekday, item = oh).formatlink ()"/>
         <td tal:content="structure python:'%02d' % oh.from_hour"/>
         <td>:</td>
         <td tal:content="structure python:'%02d' % oh.from_minute"/>
         <td>-</td>
         <td tal:content="structure python:'%02d' % oh.to_hour"/>
         <td>:</td>
         <td tal:content="structure python:'%02d' % oh.to_minute"/>
        </tr>
        <tr>
         <td style="padding-left:0px"
             tal:content="structure python:utils.new_property
             (context, db, 'opening_hours', -1, 'weekday').menu ()"/>
         <td tal:content="structure python:utils.new_property
             (context, db, 'opening_hours', -1, 'from_hour').field (size=3)"/>
         <td>:</td>
         <td tal:content="structure python:utils.new_property
             (context, db, 'opening_hours', -1, 'from_minute').field (size=3)"/>
         <td>-</td>
         <td tal:content="structure python:utils.new_property
             (context, db, 'opening_hours', -1, 'to_hour').field (size=3)"/>
         <td>:</td>
         <td tal:content="structure python:utils.new_property
             (context, db, 'opening_hours', -1, 'to_minute').field (size=3)"/>
         <input type="hidden" name="@link@opening_hours"
                value="opening_hours-1"/>
        </tr>

       </table>
      </td>
     </tr>
     <tr tal:condition="python:context.id and 'abo' in db._db.classes">
      <th>
       <span tal:condition="context/abos"
             tal:content="structure python:utils.fieldname(classname, 'abos')"/>
      </th>
      <td align="top">
       <table border="0" cellspacing="0" cellpadding="0">
        <tr tal:repeat="abo context/abos">
         <td>
          <a tal:attributes="href string:abo${abo/id}
                            ;class python:utils.get_cssclass (abo)
                            "
             tal:content="abo/aboprice">
          </a>
         </td>
        </tr>
       </table>
      </td>
      <th>
       <span tal:condition="context/payed_abos"
             tal:content="structure python:utils.fieldname
             (classname, 'payed_abos')"/>
      </th>
      <td align="top">
       <table border="0" cellspacing="0" cellpadding="0">
        <tr tal:repeat="abo context/payed_abos">
         <td>
          <a tal:attributes="href  string:abo${abo/id}
                            ;class python:utils.get_cssclass (abo)
                            "
             tal:content="abo/aboprice">
          </a>
         </td>
        </tr>
       </table>
      </td>
     </tr>
    </tal:block>
   </tal:block>
  </tal:block>
 </tal:block>
</tal:block>
