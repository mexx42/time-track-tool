<tal:block metal:define-macro="icing">
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="de-DE" id="fb"
 tal:define="
   uname           python: str (request.user.username)
 ; is_user         python: request.user.username!='anonymous'
 ; clsname         python: getattr (context, '_classname', '')
 ; classname       context/_classname|db/user/_classname
   ">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <title metal:define-slot="head_title">LieLas</title>
  <link href="@@file/lielas_style.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript"
          src="@@file/lfiles/js/jquery-1.4.2.min.js"></script>
  <script type="text/javascript"
          src="@@file/lfiles/js/jquery.tinysort.min.js"></script>
  <script type="text/javascript" src="@@file/lfiles/js/lielas.js"></script>
</head>
<body>
  <div id="frame">
    <div id="header">
      <div id="version">v1.0.0</div>
      <div id="navi">
        <div tal:condition="not:is_user" class="navi_item active">
          <div class="left"></div>
          <a>Login</a>
          <div class="right"></div>
        </div>
        <tal:block tal:condition="is_user">
          <div tal:repeat="cl python:utils.menu_by_class(db)"
               tal:attributes=
                  "class python:'navi_item'+['', ' active'][cl[0]==clsname]">
            <tal:block
               tal:define=" cn  python: cl [0]
                          ; n   python: cl [1]
                          ; url python: cl [2]
                          ">
              <div class="left"></div>
              <a tal:attributes="href url" tal:content="n"/>
              <div class="right"></div>
            </tal:block>
          </div>
          <div class="navi_item logout">
            <div class="left"></div>
            <a tal:attributes=
               "href python:request.indexargs_href ('', {'@action':'logout'})">
               Logout
            </a>
            <div class="right"></div>
          </div>
        </tal:block>
      </div>
    </div>
    <tal:block tal:condition="is_user">
      <tal:block metal:define-slot="content"/>
    </tal:block>
    <div id="content" tal:condition="not:is_user" class="login">
      <div id="sidebar">
        <div class="details_header">
            <strong>Login</strong>
        </div>
        <div class="details_body">
          <form method="POST" name="login_form" id="login_form"
                tal:attributes="action request/base">
            <ul class="details_row">
              <li>
                <label for="name" class="desc">Name:</label>
                <input type="text" name="__login_name" id="name" class="value"/>
              </li>
              <li>
                <label for="gruppe" class="desc">Passwort:</label>
                <input type="password" name="__login_password" id="pass"
                       class="value" />
              </li>
            </ul>
            <hr/>
            <div class="details_row">
              <input type="submit" name="@action" id="login" value="Login"/>
            </div>                           
          </form>
        </div>
        <div class="details_footer"></div>
      </div>
    </div>
  </div>
</body>
</html>
</tal:block>

<tal:block metal:define-macro="lielas-main">
  <tal:block metal:use-macro="templates/lielas/macros/icing">
    <tal:block metal:fill-slot="content">
      <tal:block tal:define=
          " devs  python: db.device.filter(None, {}, sort=('+', 'name'))
          ; asens python: utils.sensors_by_device (db, is_app = True)
          ; ssens python: utils.sensors_by_device (db, is_app = False)
          ; meas  python: utils.sensor_measurements (db)
          ">
        <div id=content>
          <div id=list>
            <div class="list_header" i18n:translate="">Device list</div>
            <form id="form_list" action="">                                 
              <div id="list_body">
                <ul id="list_header">
                  <li>
                    <span class="col_collapse">
                      <img src="@@file/lfiles/images/clear.png"
                           width="15" height="14"
                           id="main_collapse" alt="collapse" />
                    </span>
                    <span class="col_check">
                      <input name="checked" type="checkbox" value=""
                             class="selectbox" />
                    </span>
                    <span class="col_id">
                      <a href="#" class="sort_link active"
                         i18n:translate="">ID</a>
                    </span>
                    <span class="col_name">
                      <a href="#" class="sort_link">
                        <tal:block tal:replace="structure python:utils.fieldspan
                          ('device', 'name', endswith='')" />
                      </a>
                    </span>
                    <span class="col_device">
                      <a href="#" class="sort_link">
                      <a href="#" class="sort_link" i18n:translate="">
                        <tal:block tal:replace="structure python:utils.fieldspan
                          ('device', 'dev', endswith='')" />
                      </a>
                    </span>
                    <span class="col_group">
                      <a href="#" class="sort_link">
                        <tal:block tal:replace="structure python:utils.fieldspan
                          ('device', 'device_group', endswith='')" />
                      </a>
                    </span>
                    <span class="col_intervall">
                      <a href="#" class="sort_link">
                        <tal:block tal:replace="structure python:utils.fieldspan
                          ('device', 'mint', endswith='')" />
                      </a>
                    </span>
                  </li>
                </ul>
                <ul id="list_content">
                  <tal:block tal:repeat="d devs">
                    <li class="device" tal:attributes="id d/designator">
                      <div class="list_row main">
                        <span class="col_collapse">
                          <img src="@@file/lfiles/images/clear.png"
                               width="12" height="12" alt="collapse" />
                        </span>
                        <span class="col_check">
                          <input name="checker_main" type="checkbox"
                                 value="device_01" class="selectbox" />
                        </span>
                        <span class="col_id"     tal:content="d/id" />
                        <span class="col_name"   tal:content="d/name" />
                        <span class="col_device" tal:content="d/dev" />
                        <span class="col_group"  tal:content="d/device_group" />
                        <span class="col_intervall" tal:content="d/sint" />
                      </div>
                      <ul tal:attributes="id python:d.designator() + '_sensor'"
                          class="sensor">
                        <li tal:repeat="s python:asens [d.id]"
                            tal:attributes="id s/designator">
                          <div class="list_row">
                            <span class="col_check">
                              <input name="checker_sub" type="checkbox"
                                     tal:attributes="value s/designator"
                                     class="selectbox" />
                            </span>
                            <span class="col_name"   tal:content="s/name" />
                            <span class="col_device" tal:content="s/adr" />
                          </div>
                        </li>
                      </ul>
                    </li>
                  </tal:block>
                </ul>
              </div>
              <div class="list_footer">
                <div id="csv_export">
                    marked devices:<input name="export" type="submit" id="export" value="CSV exportieren" />
                </div>
              </div>
            </form>
          </div>
          <div id="sidebar">
            <div class="details_header">
              <strong i18n:translate="">Details:</strong>
            </div>
            <div class="details_body" tal:repeat="d devs"
                 tal:attributes="id python: 'details_' + d.designator()">
              <form method="POST" tal:attributes=
                    " id     python:'settings_form_' + d.designator()
                    ; name   python:'settings_form_' + d.designator()
                    ; action d/designator
                    ">
                <ul class="details_row">
                  <li>
                    <tal:block tal:replace="structure python:utils.fieldspan
                         ('device', 'name')" />
                    <tal:block tal:replace="structure python:d.name.field ()" />
                  </li>
                  <li>
                    <tal:block tal:replace="structure python:utils.fieldspan
                         ('device', 'dev')" />
                    <span class="value" tal:content="d/dev" />
                  </li>
                  <li>
                    <tal:block tal:replace="structure python:utils.fieldspan
                         ('device', 'device_group')" />
                    <tal:block tal:replace="structure d/device_group/menu" />
                  </li>
                </ul>
                <hr />
                <ul class="details_row">
                  <li>
                    <tal:block tal:replace="structure python:utils.fieldspan
                         ('device', 'mint')" />
                    <tal:block tal:replace="structure python:d.mint.field ()" />
                  </li>
                  <li>
                    <tal:block tal:replace="structure python:utils.fieldspan
                         ('device', 'sint')" />
                    <tal:block tal:replace="structure python:d.sint.field ()" />
                  </li>
                </ul>
                <hr />
                <div class="details_row">
                  <input type="hidden" name="@action" value="edit">
                  <input type="submit" name="submit_button"
                         id="submit_details" value="Submit Changes"
                         i18n:attributes="value" />
                </div>
              </form>
              <div class="details_row header">
                <tal:block tal:replace="structure python:utils.fieldspan
                  ('sensor', 'name', endswith='')" />
                <span class="value">
                  <tal:block tal:replace="structure python:utils.fieldspan
                    ('sensor', 'adr', endswith='', csscls='unit')" />
                  <tal:block tal:replace="structure python:utils.fieldspan
                    ('sensor', 'val', endswith='', csscls='default')" />
                </span>
              </div>
              <ul class="details_row">
                <li tal:repeat="s python:asens [d.id]">
                  <span class="desc" tal:content="s/name" />
                  <span class="value">
                    <span class="unit" tal:content="s/adr" />
                    <tal:block tal:condition="python:meas[s.id]">
                      <tal:block tal:replace="python:meas[s.id][0][1]" />
                      <tal:block tal:replace="s/unit" />
                    </tal:block>
                  </span>
                </li>
              </ul>
              <div class="details_row header">
                <span class="desc" i18n:translate="">Status</span>
              </div>
              <ul class="details_row">
                <li tal:repeat="s python:ssens [d.id]">
                  <span class="desc" tal:content="s/name" />
                  <span class="value" tal:condition="python:meas[s.id]">
                    <tal:block tal:replace="python:meas[s.id][0][1]" />
                    <tal:block tal:replace="s/unit" />
                  </span>
                </li>
              </ul>
            </div>
            <div class="details_footer"></div>
          </div>
        </div>
      </tal:block>
    </tal:block>
  </tal:block>
</tal:block>
