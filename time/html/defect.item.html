<tal:block metal:use-macro="templates/page/macros/icing">

 <title metal:fill-slot="head_title">
  <span tal:condition="context/id"
        tal:replace="string:Defect: ${context/id} by ${context/creator}"></span>
  <span tal:condition="not:context/id"
        tal:replace="string:Create New Defect Report"></span>
 </title>

 <tal:block metal:fill-slot="content">
  <tal:block metal:use-macro="templates/page/macros/ttt_issue">
   <tal:block metal:fill-slot="ttt_issue_content">
    <p tal:condition="context/closed/plain"
       tal:content="structure string:Closed on <b>${context/closed}</b>
                    by <b>${context/closer}</b>."></p>
    <tr>
     <th>Product</th>
     <td tal:content="structure context/product/menu"></td>
     <th>Version</th>
     <td tal:content="structure context/version/field"></td>
    </tr>
    <tr>
     <th>Severity</th>
     <td tal:content="structure context/severity/menu"></td>
     <th>Found in Release</th>
     <td tal:content="structure context/found_in_release/menu"></td>
    </tr>
    <tr>
     <th>Cert ?</th>
     <td tal:content="structure context/cert/field"></td>
     <th></th>
     <td></td>
    </tr>
    <tr>
     <th>Status</th>
     <td>
      <tal:block tal:condition="context/id">
      <select name="status"
              tal:condition="python:context.cert.plain () == 'Yes'"
              tal:define="ok context/status/cert_transitions">
       <option tal:attributes="value context/status/id"
               tal:content="context/status/name"></option>
       <tal:block tal:repeat="state db/defect_status/list">
       <option tal:condition="python:state.id in ok"
               tal:attributes="
                   value state/id;
                selected python:state.id == context.status.id"
               tal:content="state/name">
       </option>
       </tal:block>
      </select>
      <select name="status"
              tal:condition="python:context.cert.plain () == 'No'"
              tal:define="ok context/status/transitions">
       <option tal:attributes="value context/status/id"
               tal:content="context/status/name"></option>
       <tal:block tal:repeat="state db/defect_status/list">
       <option tal:condition="python:state.id in ok"
               tal:attributes="
                   value state/id;
                selected python:state.id == context.status.id"
               tal:content="state/name">
       </option>
       </tal:block>
      </select>
      </tal:block>
      <tal:block tal:condition="not:context/id"
                 tal:replace="structure context/status/menu" />
     </td>
     <th></th>
     <td></td>
    </tr>
    <tr>
     <th>Part of Release</th>
     <td tal:content="structure context/part_of_release/menu"></td>
     <th>Part of Feature</th>
     <td tal:content="structure context/feature/menu"></td>
    </tr>
    <tr tal:condition="context/id">
     <th>Supereder</th>
     <td colspan="3"
         tal:content="structure context/superseder/field"></td>
    </tr>
    <tr tal:condition="context/id">
     <th>Fixed in</th>
     <td colspan="3"
         tal:content="structure context/fixed_in/field"></td>
    </tr>
    <tr tal:condition="python: context.cert.plain() == 'Yes'">
     <th>Files affected</th>
     <td colspan="3">
      <textarea tal:content="request/form/files_affected/value | default"
                name="files_affected"
                wrap="hard"
                rows="5"
                cols="80"></textarea>
     </td>
    </tr>
    <tr>
     <th>Files</th>
     <td colspan="3">
      <tal:block metal:use-macro="templates/page/macros/ttt_issue_files"/>
     </td>
    </tr>

   </tal:block>
  </tal:block>
 </tal:block>

</tal:block>
