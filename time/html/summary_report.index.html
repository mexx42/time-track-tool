<tal:block metal:use-macro="templates/page/macros/icing">
<title metal:fill-slot="head_title" tal:content="Classname" />

<tal:block metal:fill-slot="create_or_query">
 <tal:block 
  metal:use-macro="templates/page/macros/create_or_query_new_tracker_item" />
</tal:block>

<tal:block metal:fill-slot="content">
 <tal:block tal:define=
  "batch request/batch;
   pdict python: utils.properties_dict (db, context);
   props python: dict
    ( date              = utils.ExtProperty 
      (utils, pdict ['date'])
    , user              = utils.ExtProperty 
      (utils, pdict ['user'],              multiselect = 1)
    , department        = utils.ExtProperty
      (utils, pdict ['department'],        multiselect = 1)
    , supervisor        = utils.ExtProperty
      (utils, pdict ['supervisor'],        multiselect = 1)
    , org_location      = utils.ExtProperty
      (utils, pdict ['org_location'],      multiselect = 1)
    , time_wp           = utils.ExtProperty 
      ( utils, pdict ['time_wp']
      , help_props = ['project', 'name']
      , searchable = True
      )
    , time_project      = utils.ExtProperty
      (utils, pdict ['time_project'],      multiselect = 1)
    , time_wp_group     = utils.ExtProperty
      (utils, pdict ['time_wp_group'],     multiselect = 1)
    , cost_center       = utils.ExtProperty
      (utils, pdict ['cost_center'],       multiselect = 1)
    , cost_center_group = utils.ExtProperty 
      (utils, pdict ['cost_center_group'], multiselect = 1)
    , summary_type      = utils.ExtProperty
      (utils, pdict ['summary_type'],      multiselect = 1)
    , summary           = utils.ExtProperty
      (utils, pdict ['summary'])
    , show_empty        = utils.ExtProperty
      (utils, pdict ['show_empty'],     bool_tristate = False)
    , show_all_users    = utils.ExtProperty
      (utils, pdict ['show_all_users'], bool_tristate = False)
    , status            = utils.ExtProperty
      (utils, pdict ['status'],            multiselect = 1)
    , planned_effort    = utils.ExtProperty
      (utils, pdict ['planned_effort'])
    );
    sr   python: utils.Summary_Report (db, request)
   "
  tal:condition="context/is_view_ok">
  <tal:block tal:replace="structure python:sr.as_html ()"/>
  <tal:block tal:define=
      " fpkeys python:
        [ 'user', 'time_wp', 'time_project', 'time_wp_group', 'cost_center'
        , 'cost_center_group', 'summary', 'planned_effort'
        ]
      ; dummy python:fpkeys.sort ()
      ; filtered_props python: [props [p] for p in fpkeys]
      ; propkeys       python:
        ( 'date', 'user', 'department', 'supervisor', 'org_location', 'time_wp'
        , 'time_project', 'time_wp_group', 'cost_center', 'cost_center_group'
        , 'summary_type', 'status', 'show_empty', 'show_all_users'
        )
      ; sprops         python: [props [p] for p in propkeys]
      ; multi_props    python: [p for p in sprops if p.multiselect]
      ; sort_props     python: []
      ; nomulti_props  python: [p for p in sprops
                                if not p.multiselect and p.searchable]
      ; csv_link       python:request.indexargs_url
             (classname, {'@action':'csv_summary_report'})
      ; do_fulltext    python: False
      ; do_pagesize    python: False
      ">
   <tal:block metal:use-macro="templates/page/macros/search_form"/>
  </tal:block>
 </tal:block>
</tal:block>
</tal:block>
