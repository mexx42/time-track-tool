<tal:block metal:use-macro="templates/lielas/macros/icing">
  <tal:block metal:fill-slot="content">
    <tal:block tal:define=
         " u     python:db.user.getItem(db._db.getuid ())
         ; t     python:(db.transceiver.list() or [None])[0]
         ; d     python:(db.dyndns.list() or [None])[0]
         ; dh    python:d and utils.dyndns_default_host (db, d)
         ; ds    python:dh and dh.dyndns_service
         ; um    python:(db.umts.list() or [None])[0]
         ; dba   python:utils.user_has_role (db._db, request.user.id, 'Admin')
         ; sel   python: (  classname == 'user' and context
                         or u
                         ).designator()
         ">
      <div id="content" class="settings">
        <div id="list">
          <div class="list_header" i18n:translate="">Settings</div>
          <div id="settings_body">
            <form id="settings" action="dyndns" method="POST">
              <div class="settings_header" i18n:translate="">Device</div>
              <div class="settings_row">
                <div class="settings_title" i18n:translate="">User:</div>
                <tal:block tal:replace="structure python:utils.fieldlabel
                     ('user', 'username')" />
                <div class="settings_field"
                     tal:content="structure u/username/field"/>
              </div>
              <div class="settings_row">
                <tal:block tal:replace="structure python:utils.fieldlabel
                     ('user', 'password')" />
                <div class="settings_field"
                     tal:content="structure u/password/field"/>
              </div>
              <div class="settings_row">
                <tal:block tal:replace="structure python:utils.fieldlabel
                     ('user', 'confirm')" />
                <div class="settings_field"
                     tal:content="structure u/password/confirm"/>
              </div>
              <tal:block tal:condition="t">
                <hr />
                <div class="settings_row">
                  <div class="settings_title"
                       i18n:translate="">Intervals for all devices:</div>
                  <tal:block tal:replace="structure python:utils.fieldlabel
                       ('transceiver', 'mint')" />
                  <div tal:attributes="class python:
                       'settings_field'
                       + ['',' settings_pending'][bool(t.mint_pending._value)]"
                       tal:content="structure t/mint/field"/>
                </div>
                <div class="settings_row">
                  <tal:block tal:replace="structure python:utils.fieldlabel
                       ('transceiver', 'sint')" />
                  <div tal:attributes="class python:
                       'settings_field'
                       + ['',' settings_pending'][bool(t.sint_pending._value)]"
                       tal:content="structure t/sint/field"/>
                </div>
              </tal:block>
              <tal:block tal:condition="python: d or um">
                <div class="settings_header" i18n:translate="">Internet</div>
                <tal:block tal:condition="python: d">
                  <div class="settings_row">
                    <div class="settings_title" i18n:translate="">DynDNS:</div>
                    <tal:block tal:replace="structure python:utils.fieldlabel
                         ('dyndns', 'syslog')" />
                    <input type="hidden" id="syslog" tal:attributes=
                           " value python: d.syslog._value
                           ; name  python: d.syslog._formname
                           ">
                    <div class="settings_checkbox">
                      <input id="syslog_cb" type="checkbox"
                             tal:attributes="checked d/syslog">
                    </div>
                  </div>
                  <div class="settings_row">
                    <tal:block tal:replace="structure python:utils.fieldlabel
                         ('dyndns', 'web_url')" />
                    <div class="settings_field"
                         tal:content="structure d/web_url/field"/>
                  </div>
                  <div class="settings_row">
                    <tal:block tal:replace="structure python:utils.fieldlabel
                         ('dyndns_server', 'server')" />
                    <div class="settings_field"
                         tal:content="structure ds/server/field"/>
                  </div>
                  <div class="settings_row">
                    <tal:block tal:replace="structure python:utils.fieldlabel
                         ('dyndns_server', 'protocol')" />
                    <div class="settings_field"
                         tal:content="structure ds/protocol/menu"/>
                  </div>
                  <div class="settings_row">
                    <tal:block tal:replace="structure python:utils.fieldlabel
                         ('dyndns_server', 'login')" />
                    <div class="settings_field"
                         tal:content="structure ds/login/field"/>
                  </div>
                  <div class="settings_row">
                    <tal:block tal:replace="structure python:utils.fieldlabel
                         ('dyndns_server', 'password')" />
                    <div class="settings_field"
                         tal:content="structure ds/password/field"/>
                  </div>
                  <div class="settings_row">
                    <tal:block tal:replace="structure python:utils.fieldlabel
                         ('dyndns_server', 'hostname')" />
                    <div class="settings_field"
                         tal:content="structure dh/hostname/field"/>
                  </div>
                </tal:block>
                <tal:block tal:condition="python: um">
                  <hr />
                  <div class="settings_row">
                    <div class="settings_title"
                         i18n:translate="">UMTS-Internet-Access:</div>
                    <tal:block tal:replace="structure python:utils.fieldlabel
                         ('umts', 'pin')" />
                    <div class="settings_field"
                         tal:content="structure um/pin/field"/>
                  </div>
                </tal:block>
              </tal:block>
              <hr />
              <div tal:attributes="class python:
                   ['settings_bottom','settings_action'][bool(dba)]">
                <input type="hidden" name="@template" value="lindex">
                <input type="hidden" name="@action" value="edit">
                <span class="buttonbox submit_details orangebutton">
                  <input type="submit" name="settings_submit"
                         id="settings_submit" value="Submit Changes"
                         i18n:attributes="value" />
                </span>
              </div>
            </form>
            <form id="dba_form" action="transceiver" method="POST"
                  tal:condition="python: dba">
              <div class="settings_header"
                   i18n:translate="">Database Maintenance</div>
              <div class="settings_row">
                <div class="settings_title" i18n:translate="">Database:</div>
                <label i18n:translate="">Database Operation:</label>
                <div class="settings_field">
                  <select name="database" id="database">
                    <option></option>
                    <option tal:repeat="a python:
                            utils.lielas_actions.iteritems()"
                            tal:attributes="value python:a[0]"
                            tal:content="python:i18n.gettext(a[1][0])"/>
                  </select>
                </div>
              </div>
              <hr />
              <div id="settings_bottom" class="settings_bottom">
                <input type="hidden"
                       tal:repeat="a python:utils.lielas_actions.iteritems()"
                       tal:attributes=
                        " id   python: 'delete_'+a[0]
                        ; name python: i18n.gettext(a[1][2])
                        "/>
                <input id="dba_action" type="hidden" name="@action"
                       value="edit">
                <span id="dba_span" class="submit_invisible">
                  <input type="submit" name="dba_submit"
                         id="dba_submit" value="Submit Changes"
                         i18n:attributes="value" />
                </span>
              </div>
            </form>
          </div>
        </div>
      </div>
    </tal:block>
  </tal:block>
</tal:block>
