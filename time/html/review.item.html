<tal:block metal:use-macro="templates/page/macros/icing">

 <title metal:fill-slot="head_title">
  <span tal:condition="context/id"
        tal:replace="string:Review: ${context/id} by ${context/creator}"></span>
  <span tal:condition="not:context/id"
        tal:replace="string:Create New Review"></span>
 </title>

 <tal:block metal:fill-slot="create_or_query">
  <tal:block 
   metal:use-macro="templates/page/macros/create_or_query_new_tracker_item" />
 </tal:block>

 <tal:block metal:fill-slot="content">
 <tal:block tal:define="responsible_required string:required;
                        required_attributes string:title,responsible,qa_representative,recorder,authors,peer_reviewers,cut_off_date;
                        announcements python:db.announcement.filter ( filterspec = { 'review' : context.id }
                                                                    , sort       = ( '+', 'id'    )
                                                                    );">

  <tal:block metal:use-macro="templates/page/macros/formatted_class">
   <tal:block metal:fill-slot="formatted_class_content">

    <tr>
     <th class="required" 
      tal:content="structure python:utils.fieldname(classname, 'recorder')" />
     <td>
      <tal:block tal:define="name      string:recorder;
                             form      string:itemSynopsis;
                             dont_care string:don't care;
                             selected python:context.recorder and context.recorder.id or 0">
       <tal:block metal:use-macro="templates/userlist/macros/user"></tal:block>
      </tal:block>
     </td>
     <th class="required"
         tal:content="structure python:utils.fieldname
         (classname, 'qa_representative')" />
     <td>
      <tal:block tal:define="name      string:qa_representative;
                             form      string:itemSynopsis;
                             dont_care string:don't care;
                             selected python:context.qa_representative and context.qa_representative.id or 0">
       <tal:block metal:use-macro="templates/userlist/macros/user"></tal:block>
      </tal:block>
     </td>
    </tr>

    <tr>
     <th class="required"
      tal:content="structure python:utils.fieldname (classname, 'authors')" />
     <td colspan="3">
      <tal:block tal:define="size      string:3;
                             name      string:authors;
                             form      string:itemSynopsis;
                             dont_care string:don't care;
                             selected  python:str([u.id for u in context.authors.reverse ()] or [''])[1:-1]">
       <tal:block metal:use-macro="templates/userlist/macros/user_multi"></tal:block>
      </tal:block>
     </td>
    </tr>

    <tr>
     <th class="required"
      tal:content="structure python:utils.fieldname
      (classname, 'peer_reviewers')" />
     <td>
      <tal:block tal:define="size      string:3;
                             name      string:peer_reviewers;
                             form      string:itemSynopsis;
                             dont_care string:don't care;
                             selected  python:str([u.id for u in context.peer_reviewers.reverse ()] or [''])[1:-1]">
       <tal:block metal:use-macro="templates/userlist/macros/user_multi"></tal:block>
      </tal:block>
     </td>
     <th tal:content="structure python:utils.fieldname
         (classname, 'opt_reviewers')" />
     <td>
      <tal:block tal:define="size      string:3;
                             name      string:opt_reviewers;
                             form      string:itemSynopsis;
                             dont_care string:don't care;
                             selected  python:str([u.id for u in context.opt_reviewers.reverse ()] or [''])[1:-1]">
       <tal:block metal:use-macro="templates/userlist/macros/user_multi"></tal:block>
      </tal:block>
     </td>
    </tr>

    <tr>
     <th class="required"
      tal:content="structure python:utils.fieldname
      (classname, 'cut_off_date')" />
     <td colspan="3">
      <span tal:content="structure context/cut_off_date/field"/>
      <span tal:content="structure python:utils.date_help (request, context.cut_off_date)"/>
     </td>
    </tr>

    <tr>
     <th tal:content="structure python:utils.fieldname
      (classname, 'final_meeting_date')" />
     <td colspan="3">
      <span tal:content="structure context/final_meeting_date/field"/>
      <span tal:content="structure python:utils.date_help (request, context.final_meeting_date)"/>
     </td>
    </tr>

    <tr tal:condition="announcements">
     <th tal:content="structure python:utils.fieldname
      (classname, 'announcements')" />
     <td colspan="3" class="task_list">
      <tal:block tal:define="items announcements;
                             klassname string:announcement;">
       <tal:block metal:use-macro="templates/page/macros/simple_list"/>
      </tal:block>
     </td>
    </tr>

    <tal:block tal:condition="context/id">
    <tr tal:condition="context/is_edit_ok"
        class="add_new">
     <th tal:content="structure python:utils.fieldname
      (classname, 'add_announcement')" />
     <td>
      <table>
       <tr>
        <th class="required" tal:content="structure python:utils.fieldname
         ('announcement', 'title')" />
        <td><input type="text" name="announcement-1@title" size="40"></td>
       </tr>
       <tr>
        <th class="required" tal:content="structure python:utils.fieldname
         ('announcement', 'version')" />
        <td><input type="text" name="announcement-1@version" size="40"></td>
       </tr>
       <tr>
        <th class="required" tal:content="structure python:utils.fieldname
         ('announcement', 'meeting_room')" />
        <td tal:content="structure python:utils.new_property
         (context, db, 'announcement', -1, 'meeting_room').menu()">
        </td>
       </tr>
<!-- doesnt work !
       <tr>
        <th tal:content="structure python:utils.fieldname
         (classname, 'add_file')" />
        <td><input type="file" name="announcement-1@file" size="40"></td>
       </tr>
-->
      </table>
      <input type="hidden" name="@link@announcements" value="announcement-1" />
     </td>
    </tr>
    </tal:block>



    <tr>
     <th tal:content="structure python:utils.fieldname
      (classname, 'files')" />
     <td colspan="3">
      <tal:block metal:use-macro="templates/page/macros/formatted_class_files"/>
     </td>
    </tr>

   </tal:block>
  </tal:block>
 </tal:block>
 </tal:block>
</tal:block>
