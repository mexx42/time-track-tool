<tal:block metal:use-macro="templates/page/macros/icing">

 <title metal:fill-slot="head_title">
  <span tal:condition="context/id"
        tal:replace="string:Review: ${context/id} by ${context/creator}"></span>
  <span tal:condition="not:context/id"
        tal:replace="string:Create New Review"></span>
 </title>

 <tal:block metal:fill-slot="content">
 <tal:block tal:define="responsible_title string:Moderator;
                        responsible_required string:required;
                        required_attributes string:title,responsible,qa_representative,recorder,authors,peer_reviewers,cut_off_date;
                        announcements python:db.announcement.filter ( filterspec = { 'review' : context.id }
                                                                    , sort       = ( '+', 'id'    )
                                                                    );">

  <tal:block metal:use-macro="templates/page/macros/ttt_issue">
   <tal:block metal:fill-slot="ttt_issue_content">

    <tr>
     <th class="required">QA Representative</th>
     <td colspan="3">
      <tal:block tal:define="name      string:qa_representative;
                             form      string:itemSynopsis;
                             dont_care string:don't care;
                             selected  context/qa_representative/id | string:0">
       <tal:block metal:use-macro="templates/userlist/macros/user"></tal:block>
      </tal:block>
     </td>
    </tr>

    <tr>
     <th class="required">Recorder</th>
     <td colspan="3">
      <tal:block tal:define="name      string:recorder;
                             form      string:itemSynopsis;
                             dont_care string:don't care;
                             selected  context/recorder/id | string:0">
       <tal:block metal:use-macro="templates/userlist/macros/user"></tal:block>
      </tal:block>
     </td>
    </tr>

    <tr>
     <th class="required">Authors</th>
     <td colspan="3">
      <tal:block tal:define="size      string:3;
                             name      string:authors;
                             form      string:itemSynopsis;
                             dont_care string:don't care;
                             selected  python:str([u.id for u in context.authors.reverse ()] or [''])[1:-1]">
       <tal:block metal:use-macro="templates/userlist/macros/user_multi"></tal:block>
      </tal:block>
     </td>
    </tr>

    <tr>
     <th class="required">Peer Reviewers</th>
     <td colspan="3">
      <tal:block tal:define="size      string:3;
                             name      string:peer_reviewers;
                             form      string:itemSynopsis;
                             dont_care string:don't care;
                             selected  python:str([u.id for u in context.peer_reviewers.reverse ()] or [''])[1:-1]">
       <tal:block metal:use-macro="templates/userlist/macros/user_multi"></tal:block>
      </tal:block>
     </td>
    </tr>

    <tr>
     <th>Optional Reviewers</th>
     <td colspan="3">
      <tal:block tal:define="size      string:3;
                             name      string:opt_reviewers;
                             form      string:itemSynopsis;
                             dont_care string:don't care;
                             selected  python:str([u.id for u in context.opt_reviewers.reverse ()] or [''])[1:-1]">
       <tal:block metal:use-macro="templates/userlist/macros/user_multi"></tal:block>
      </tal:block>
     </td>
    </tr>

    <tr>
     <th class="required">Cut Off Date</th>
     <td colspan="3">
      <span tal:content="structure context/cut_off_date/field"/>
      <span tal:content="structure python:utils.date_help (request, context.cut_off_date)"/>
     </td>
    </tr>

    <tr>
     <th>Final Meeting Date</th>
     <td colspan="3">
      <span tal:content="structure context/final_meeting_date/field"/>
      <span tal:content="structure python:utils.date_help (request, context.final_meeting_date)"/>
     </td>
    </tr>

    <tr tal:condition="announcements">
     <th>Announcements</th>
     <td colspan="3" class="task_list">
      <tal:block tal:define="items announcements;
                             klassname string:announcement;">
       <tal:block metal:use-macro="templates/page/macros/ttt_simple_list"/>
      </tal:block>
     </td>
    </tr>

    <tal:block tal:condition="context/id">
    <tr tal:condition="context/is_edit_ok"
        class="add_new">
     <th>Add Announcement</th>
     <td>
      <table>
       <tr>
        <th class="required">Title</th>
        <td><input type="text" name="announcement-1@title" size="40"></td>
       </tr>
       <tr>
        <th class="required">Version</th>
        <td><input type="text" name="announcement-1@version" size="40"></td>
       </tr>
       <tr>
        <th class="required">Location</th>
        <td><input type="text" name="announcement-1@location" size="40"></td>
       </tr>
<!-- doesnt work !
       <tr>
        <th>Add File</th>
        <td><input type="file" name="announcement-1@file" size="40"></td>
       </tr>
-->
      </table>
      <input type="hidden" name="@link@announcements" value="announcement-1" />
     </td>
    </tr>
    </tal:block>



    <tr>
     <th>Files</th>
     <td colspan="3">
      <tal:block metal:use-macro="templates/page/macros/ttt_issue_files"/>
     </td>
    </tr>

   </tal:block>
  </tal:block>
 </tal:block>
 </tal:block>
</tal:block>
