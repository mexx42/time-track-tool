<tal:block tal:condition="utils/is_lielas">
  <tal:block metal:use-macro="templates/lielas/macros/icing">
    <tal:block metal:fill-slot="content">
      <tal:block tal:define=
          " devs  python: db.device.filter(None, {}, sort=('+', 'name'))
          ; asens python: utils.sensors_by_device (db, is_app = True)
          ; ssens python: utils.sensors_by_device (db, is_app = False)
          ; meas  python: utils.sensor_measurements (db)
          ">
        <div id=content>
          <div id=list>
            <div class="list_header" i18n:translate="">Device list</div>
            <form id="form_list" action="">                                 
              <div id="list_body">
                <ul id="list_header">
                  <li>
                    <span class="col_collapse">
                      <img src="@@file/lfiles/images/clear.png"
                           width="15" height="14"
                           id="main_collapse" alt="collapse" />
                    </span>
                    <span class="col_check">
                      <input name="checked" type="checkbox" value=""
                             class="selectbox" />
                    </span>
                    <span class="col_id">
                      <a href="#" class="sort_link active"
                         i18n:translate="">ID</a>
                    </span>
                    <span class="col_name">
                      <a href="#" class="sort_link"
                         i18n:translate="">Name</a>
                    </span>
                    <span class="col_device">
                      <a href="#" class="sort_link"
                         i18n:translate="">Device</a>
                    </span>
                    <span class="col_group">
                      <a href="#" class="sort_link"
                         i18n:translate="">Group</a>
                    </span>
                    <span class="col_intervall">
                      <a href="#" class="sort_link"
                         i18n:translate="">Interval</a>
                    </span>
                  </li>
                </ul>
                <ul id="list_content">
                  <tal:block tal:repeat="d devs">
                    <li class="device" tal:attributes="id d/designator">
                      <div class="list_row main">
                        <span class="col_collapse">
                          <img src="@@file/lfiles/images/clear.png"
                               width="12" height="12" alt="collapse" />
                        </span>
                        <span class="col_check">
                          <input name="checker_main" type="checkbox"
                                 value="device_01" class="selectbox" />
                        </span>
                        <span class="col_id"     tal:content="d/id"/>
                        <span class="col_name"   tal:content="d/name"/>
                        <span class="col_device" tal:content="d/dev"/>
                        <span class="col_group"  tal:content="d/device_group"/>
                        <span class="col_intervall" tal:content="d/sint"/>
                      </div>
                      <ul tal:attributes="id python:d.designator() + '_sensor'"
                          class="sensor">
                        <li tal:repeat="s python:asens [d.id]"
                            tal:attributes="id s/designator">
                          <div class="list_row">
                            <span class="col_check">
                              <input name="checker_sub" type="checkbox"
                                     tal:attributes="value s/designator"
                                     class="selectbox" />
                            </span>
                            <span class="col_name"   tal:content="s/name"/>
                            <span class="col_device" tal:content="s/adr"/>
                          </div>
                        </li>
                      </ul>
                    </li>
                  </tal:block>
                </ul>
              </div>
              <div class="list_footer">
                <div id="csv_export">
                    marked devices:<input name="export" type="submit" id="export" value="CSV exportieren"/>
                </div>
              </div>
            </form>
          </div>
          <div id="sidebar">
            <div class="details_header">
              <strong i18n:translate="">Details:</strong>
            </div>
            <div class="details_body" tal:repeat="d devs"
                 tal:attributes="id python: 'details_' + d.designator()">
              <form id="settings_form" action="">
                <ul class="details_row">
                  <li>
                    <tal:block tal:replace="structure python:utils.fieldspan
                         ('device', 'name')"/>
                    <tal:block tal:replace="structure python:d.name.field ()"/>
                  </li>
                  <li>
                    <tal:block tal:replace="structure python:utils.fieldspan
                         ('device', 'dev')"/>
                    <span class="value" tal:content="d/dev"/>
                  </li>
                  <li>
                    <tal:block tal:replace="structure python:utils.fieldspan
                         ('device', 'device_group')"/>
                    <tal:block tal:replace="structure d/device_group/menu"/>
                  </li>
                </ul>
                <hr/>
              <div class="details_row header">
                <span class="desc" i18n:translate="">Sensor</span>
                <span class="value" i18n:translate="">
                  <span class="unit" i18n:translate="">Kanal</span>Wert
                </span>
              </div>
              <ul class="details_row">
                <li tal:repeat="s python:asens [d.id]">
                  <span class="desc" tal:content="s/name"/>
                  <span class="value">
                    <span class="unit" tal:content="s/adr"/>
                    <tal:block tal:condition="python:meas[s.id]">
                      <tal:block tal:replace="python:meas[s.id][0][1]"/>
                      <tal:block tal:replace="s/unit"/>
                    </tal:block>
                  </span>
                </li>
              </ul>
              <div class="details_row header">
                <span class="desc" i18n:translate="">Status</span>
              </div>
              <ul class="details_row">
                <li tal:repeat="s python:ssens [d.id]">
                  <span class="desc" tal:content="s/name"/>
                  <span class="value" tal:condition="python:meas[s.id]">
                    <tal:block tal:replace="python:meas[s.id][0][1]"/>
                    <tal:block tal:replace="s/unit"/>
                  </span>
                </li>
              </ul>
            </div>
            <div class="details_footer"></div>
          </div>
        </div>
      </tal:block>
    </tal:block>
  </tal:block>
</tal:block>
<tal:block tal:condition="not:utils/is_lielas">
  <tal:block metal:use-macro="templates/page/macros/icing">
   <title metal:fill-slot="head_title" i18n:translate="">Welcome</title>
   <tal:block metal:fill-slot="create_or_query">
    <tal:block 
     metal:use-macro="templates/page/macros/create_or_query_new_tracker_item" />
   </tal:block>
   <span metal:fill-slot="body_title"/>

   <tal:block metal:fill-slot="menubar"/>
   <td class="content" metal:fill-slot="content">
    <tal:block tal:replace="structure python: utils.welcome (db._db)"/>
   </td>
  </tal:block>
</tal:block>
