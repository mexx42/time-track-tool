<tal:block metal:use-macro="templates/page/macros/icing">

 <title metal:fill-slot="head_title">
  <span tal:condition="context/id"
        tal:replace="string:Announcement: ${context/id} by ${context/creator}"></span>
  <span tal:condition="not:context/id"
        tal:replace="string:Create New Announcement"></span>
 </title>

 <tal:block metal:fill-slot="create_or_query">
  <tal:block 
   metal:use-macro="templates/page/macros/create_or_query_new_tracker_item" />
 </tal:block>

 <tal:block metal:fill-slot="content">
 <tal:block tal:define="responsible_required string:required;
                        required_attributes string:title,responsible,version,room;
                        comments python:db.comment.filter ( filterspec = { 'announcement' : context.id }
                                                          , sort       = ( '+', 'id'    )
                                                          );">

  <tal:block metal:use-macro="templates/page/macros/formatted_class">
   <tal:block metal:fill-slot="formatted_class_content">

    <tr>
     <th class="required" tal:content=
      "structure python:utils.fieldname('announcement','version')"/>
     <td colspan="3">
      <span tal:content="structure context/version/field"/>
     </td>
    </tr>

    <tr>
     <th class="required" tal:content=
      "structure python:utils.fieldname('announcement','room')"/>
     <td colspan="3">
      <span tal:content="structure context/room/menu"/>
     </td>
    </tr>

    <tr>
     <th tal:content=
      "structure python:utils.fieldname('announcement','review')"/>
     <td colspan="3">
      <a tal:attributes="href context/review/designator"
         tal:content="structure context/review/title"/>
     </td>
    </tr>

    <tr>
     <th tal:content=
      "structure python:utils.fieldname('announcement','status')"/>
     <td colspan="3">
      <span tal:content="structure context/status/menu"/>
     </td>
    </tr>

    <tr tal:condition="comments">
     <th tal:content=
      "structure python:utils.fieldname('announcement','comments')"/>
     <td colspan="3" class="task_list">
      <tal:block tal:define="items comments;
                             klassname string:comment;">
       <tal:block metal:use-macro="templates/page/macros/simple_list"/>
      </tal:block>
     </td>
    </tr>

    <tr tal:condition="context/is_edit_ok"
        class="add_new">
     <th tal:content=
      "structure python:utils.fieldname('announcement','comments')"/>
     <td>
      <table>
       <tr>
        <th class="required" tal:content=
         "structure python:utils.fieldname('comment','title')"/>
        <td><input type="text" name="comment-1@title" size="40"></td>
       </tr>
       <tr>
        <th class="required" tal:content=
         "structure python:utils.fieldname('comment','severity')"/>
        <td>
         <select name="comment-1@severity">
          <option selected="selected" value="-1">- select severity of comment -</option>
          <option tal:repeat="k db/severity/list"
                  tal:attributes="value k/id"
                  tal:content="k/name">
          </option>
         </select>
        </td>
       </tr>
       <tr>
        <th tal:content=
         "structure python:utils.fieldname('comment','file_name')"/>
        <td><input type="text" name="comment-1@file_name" size="40"></td>
       </tr>
       <tr>
        <th tal:content=
         "structure python:utils.fieldname('comment','line_number')"/>
        <td><input type="text" name="comment-1@line_number" size="40"></td>
       </tr>
      </table>
      <input type="hidden" name="@link@comments" value="comment-1" />
     </td>
    </tr>

    <tr>
     <th tal:content=
      "structure python:utils.fieldname('announcement','add_file')"/>
     <td colspan="3">
      <tal:block metal:use-macro="templates/page/macros/formatted_class_files"/>
     </td>
    </tr>

   </tal:block>
  </tal:block>
 </tal:block>
 </tal:block>
</tal:block>
