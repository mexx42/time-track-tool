<tal:block metal:use-macro="templates/page/macros/icing">
 <title metal:fill-slot="head_title">
  <tal:block tal:condition="context/id" i18n:translate="">
   <span tal:replace="string:${Classname}: ${context/id}"
    i18n:name="classname_id"/>
   created by
   <span tal:replace="context/creator" i18n:name="creator"/>
  </tal:block>
  <tal:block tal:condition="not:context/id" i18n:translate="">New
   <span tal:replace="Classname" i18n:name="Classname" />
  </tal:block>
 </title>
  <tal:block metal:fill-slot="create_or_query">
    <tal:block 
     metal:use-macro="templates/page/macros/create_or_query_new_tracker_item" />
  </tal:block> 

 <span metal:fill-slot="body_title" tal:omit-tag="python:1"
       tal:content="Classname"></span>

 <tal:block metal:fill-slot="content">
  <tal:block metal:use-macro="templates/page/macros/formatted_class">
   <tal:block metal:fill-slot="formatted_class_content">
    <tr>
     <th tal:content="structure python:utils.fieldname
         (classname, 'deputy')"/>
     <td>
      <tal:block tal:define="name      string:deputy;
                             form      string:itemSynopsis;
                             dont_care string:don't care;
                             selected python:context.deputy and context.deputy.id or 0">
       <tal:block metal:use-macro="templates/userlist/macros/user"></tal:block>
      </tal:block>
     </td>
    </tr>
    <tr>
     <th tal:content="structure python:utils.fieldname
         (classname, 'description')"/>
     <td tal:content="structure python:context.description.field (size=60)"
      colspan="3"/>
    </tr>
    <tr>
     <th class="required" tal:content="structure python:utils.fieldname
         (classname, 'cost_center')"/>
     <td tal:define="ccs python: db.cost_center_status.filter
                     (None, dict (active = True))">
      <tal:block tal:replace="structure context/cost_center/field"/>
      <tal:block tal:condition="context/cost_center/is_edit_ok"
          tal:replace="structure python:db.cost_center.classhelp
            ( 'id,name,description'
            , property='cost_center'
            , inputtype='radio'
            , width='600'
            , pagesize=500
            , filter='status=%s' % ','.join (i.id for i in ccs)
            )"/>
     </td>
     <td tal:condition="context/id" tal:content="structure python:
        utils.ExtProperty
          ( utils
          , context.cost_center.name
          , item=context.cost_center
          ).formatlink()"/>
    </tr>
    <tr>
     <th tal:content="structure python:utils.fieldname
         (classname, 'organisation')"/>
     <td tal:content="structure python:context.organisation.menu ()"/>
     <th tal:content="structure python:utils.fieldname
         (classname, 'department')"/>
     <td tal:content="structure python:context.department.menu ()"/>
    </tr>
    <tr>
     <th tal:content="structure python:utils.fieldname
         (classname, 'planned_effort')"/>
     <td tal:content="structure python:context.planned_effort.field ()"/>
     <th tal:content="structure python:utils.fieldname (classname, 'status')"/>
     <td tal:content="structure python:context.status.menu ()"/>
    </tr>
    <tr>
     <th tal:content="structure python:utils.fieldname
      (classname, 'work_location')"/>
     <td tal:content="structure python:context.work_location.menu ()"/>
     <th tal:content="structure python:utils.fieldname
      (classname, 'max_hours')"/>
     <td tal:content="structure python:context.max_hours.field ()"/>
    </tr>
    <tr>
     <th tal:content="structure python:utils.fieldname
      (classname, 'op_project')"/>
     <td tal:content="structure python:context.op_project.field ()"/>
     <th tal:content="structure python:utils.fieldname
      (classname, 'no_overtime')"/>
     <td tal:content="structure python:context.no_overtime.field ()"/>
    </tr>
    <tr>
     <th tal:content="structure python:utils.fieldname
      (classname, 'is_public_holiday')"/>
     <td tal:content="structure python:context.is_public_holiday.field ()"/>
    </tr>
   </tal:block>
  </tal:block>
  <tal:block tal:condition="context/is_view_ok"
   tal:define="wps python:db.time_wp.filter
   (None, {'project' : context.id})">
   <table class="files">
    <tr tal:define=
     "uid  python:db._db.getuid ()
     ;user python:db._db.user.get (uid, 'username')
     ;cond python: not not
           (   context.id
           and (  user == str (context.responsible)
               or user == str (context.deputy)
               or utils.user_has_role (db._db, uid, 'Project')
               )
           and context.status.active
           )
     ">
     <th tal:attributes="colspan python:3-cond" class="header"
      i18n:translate="">
      Current Work Package(s)
     </th>
     <td class="header" tal:condition="cond">
      <a i18n:translate="" tal:attributes="href python:
      'time_wp?:template=item&' + '&'.join
      ([ '%s=%s' % (i [0], utils.urlquote (str (i [1]))) for i in
        [ ('project',     context.name)
        , ('responsible', user)
        , ('bookers',     user)
        ]
       ]
      )">
         new time_wp
      </a>
     </td>
    </tr>
    <tr>
     <th tal:content="structure python:utils.fieldname ('time_wp', 'name')"/>
     <th tal:content="structure python:utils.fieldname ('time_wp', 'wp_no')"/>
     <th tal:content="structure python:utils.fieldname
      ('time_wp', 'description')"/>
    </tr>
    <tr tal:repeat="wp wps">
     <td tal:content="structure python:utils.ExtProperty
      (utils, wp.name, item = wp).formatlink ()"/>
     <td tal:content="wp/wp_no"/>
     <td tal:content="wp/description"/>
    </tr>
   </table>
  </tal:block>
 </tal:block>

</tal:block>
