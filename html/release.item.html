<tal:block metal:use-macro="templates/page/macros/icing">

 <title metal:fill-slot="head_title">
  <span tal:condition="context/id"
        tal:replace="string:Release: ${context/id} by ${context/creator}"></span>
  <span tal:condition="not:context/id"
        tal:replace="string:Create New Release"></span>
 </title>

 <tal:block metal:fill-slot="create_or_query">
  <tal:block 
   metal:use-macro="templates/page/macros/create_or_query_new_tracker_item" />
 </tal:block>

 <tal:block metal:fill-slot="content">
  <tal:block metal:use-macro="templates/page/macros/formatted_class">
   <tal:block metal:fill-slot="formatted_class_content">
    <tr tal:condition="context/id">
     <th>Milestones</th>
     <td>
      <table class="milestones">
       <tr>
        <th class="header">Milestone</th>
        <th class="header">&nbsp;planned&nbsp;</th>
        <th class="header">&nbsp;reached&nbsp;</th>
        <th class="header">&nbsp;delta</th>
       </tr>
       <tr tal:repeat="m context/milestones">
        <th tal:content="m/name"
            tal:attributes="title m/description"></th>
        <td tal:content="python:m.planned.pretty ('%d-%b-%y')"></td>
        <td>
         <span tal:condition="m/reached/_value"
               tal:content="python:m.reached.pretty ('%d-%b-%y')"/>
         <span tal:condition="not:m/reached/_value">
             <input type="checkbox"
                    tal:condition="context/is_edit_ok"
                    tal:attributes="name string:${m/designator}@reached;
                                    value m/reached/now;">
<!--
                                    "onSelect string:document.itemSynopsis.elements['@note'].value='Milestone ${m/name} reached:';
                                    onChange string:document.itemSynopsis.elements['@note'].value=''"
-->
         </span>
        </td>
        <tal:block tal:condition="m/reached/_value">
        <td tal:define="diff python:str(utils.rough_date_diff (m.reached._value, m.planned._value))"
            tal:attributes="class python:['delta_minus', 'delta_plus'][diff[0]=='+']"
            tal:content="diff">
        </td>
        </tal:block>
       </tr>
      </table>
     </td>
    </tr>

    <tr tal:condition="context/id"
        tal:define="items python:db.document.filter
                               ( filterspec = { 'release' : context.id }
                               , group      = ( '+', 'status' )
                               , sort       = ( '+', 'id'     )
                               )">
     <th>Documents</th>
     <td class="task_list">
      <tal:block tal:define="klassname string:task">
       <tal:block metal:use-macro="templates/page/macros/task_list"/>
      </tal:block>

      <table tal:condition="python:context.is_edit_ok ()
                               and (len (available) != len (db.document_type.list ()))"
             tal:define="available python:[item.id for item in items]">
       <tr>
        <th>Add by type:</th>
        <td>
         <select name="document-1@type">
          <option selected="selected" value="-1">- select Document Type -</option>
          <tal:block tal:repeat="t db/document_type/list">
          <option tal:condition="python:t.id not in available"
                  tal:attributes="value t/id"
                  tal:content="string:${t/description} (${t/name})"></option>
          </tal:block>
         </select>
        </td>
       </tr>
      </table>
      <input type="hidden" name="@link@documents" value="document-1" />
     </td>
    </tr>

    <tr tal:condition="context/features">
     <th>Features</th>
     <td class="task_list">
      <tal:block tal:define="items python:db.feature.filter
                                   ( filterspec = { 'id' : [f.id for f in context.features] }
                                   , group      = ( '+', 'status' )
                                   , sort       = ( '+', 'id'     )
                                   );
                             klassname string:feature">
       <tal:block metal:use-macro="templates/page/macros/task_list"/>
      </tal:block>
     </td>
    </tr>

    <tr tal:condition="context/planned_fixes">
     <th>Planned Fixes</th>
     <td class="task_list">
      <tal:block tal:define="items python:db.defect.filter
                                  ( filterspec = { 'id' : [d.id for d in context.planned_fixes] }
                                  , group      = ( '+', 'status' )
                                  , sort       = ( '+', 'id'     )
                                  );
                             klassname string:defect">
       <tal:block metal:use-macro="templates/page/macros/task_list"/>
      </tal:block>
     </td>
    </tr>

    <tr tal:condition="context/bugs">
     <th>Bugs</th>
     <td class="task_list">
      <tal:block tal:define="items python:db.defect.filter
                                  ( filterspec = { 'id' : [d.id for d in context.bugs] }
                                  , group      = ( '+', 'status' )
                                  , sort       = ( '+', 'id'     )
                                  );
                             klassname string:defect">
       <tal:block metal:use-macro="templates/page/macros/task_list"/>
      </tal:block>
     </td>
    </tr>

   </tal:block>
  </tal:block>
 </tal:block>

</tal:block>
